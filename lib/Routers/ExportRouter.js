"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ExportRouter = void 0;
var _PromiseRouter = _interopRequireDefault(require("../PromiseRouter"));
var _AdapterLoader = require("../Adapters/AdapterLoader");
var _rest = _interopRequireDefault(require("../rest"));
var _archiver = _interopRequireDefault(require("archiver"));
var _tmp = _interopRequireDefault(require("tmp"));
var _fs = _interopRequireDefault(require("fs"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const DefaultExportExportProgressCollectionName = '_ExportProgress';
const relationSchema = {
  fields: {
    relatedId: {
      type: 'String'
    },
    owningId: {
      type: 'String'
    }
  }
};
class ExportRouter extends _PromiseRouter.default {
  exportClassPage(req, className, jsonFileStream, where, skip, limit) {
    const databaseController = req.config.database;
    const options = {
      skip,
      limit
    };
    const findPromise = className.indexOf('_Join') === 0 ? databaseController.adapter.find(className, relationSchema, where, options) : _rest.default.find(req.config, req.auth, className, where, options);
    return findPromise.then(data => {
      if (Array.isArray(data)) {
        data = {
          results: data.map(obj => {
            // Needed to avoid errors during import.
            // See more: https://docs.parseplatform.org/js/guide/#error-codes

            // Deletes invalid keys in order to avoid "ParseError: 105 Invalid field name"
            // when importing
            Object.keys(obj).forEach(key => {
              if (key.startsWith('_')) {
                delete obj[key];
              }
            });
            return obj;
          })
        };
      }
      if (skip && data.results.length) {
        jsonFileStream.write(',\n');
      }
      jsonFileStream.write(JSON.stringify(data.results, null, 2).substr(1).slice(0, -1));
    });
  }
  exportClass(req, data) {
    const databaseController = req.config.database;
    const tmpJsonFile = _tmp.default.fileSync();
    const jsonFileStream = _fs.default.createWriteStream(tmpJsonFile.name);
    jsonFileStream.write('{\n"results" : [\n');
    const hasJoin = data.name.indexOf('_Join') === 0;
    let findPromise = null;
    if (hasJoin) {
      findPromise = databaseController.adapter.count(data.name, relationSchema, data.where);
    } else {
      findPromise = _rest.default.find(req.config, req.auth, data.name, data.where, {
        count: true,
        limit: 0
      });
    }
    return findPromise.then(result => {
      if (Number.isInteger(result)) {
        result = {
          count: result
        };
      }
      let i = 0;
      const pageLimit = 1000;
      let promise = Promise.resolve();
      for (i = 0; i < result.count; i += pageLimit) {
        const skip = i;
        promise = promise.then(() => {
          return this.exportClassPage(req, data.name, jsonFileStream, data.where, skip, pageLimit);
        });
      }
      return promise;
    }).then(() => {
      jsonFileStream.end(']\n}');
      return new Promise(resolve => {
        jsonFileStream.on('close', () => {
          tmpJsonFile._name = `${data.name.replace(/:/g, 'êž‰')}.json`;
          resolve(tmpJsonFile);
        });
      });
    });
  }
  handleExportProgress(req) {
    const databaseController = req.config.database;
    const query = {
      masterKey: req.info.masterKey,
      applicationId: req.info.appId
    };
    return databaseController.find(DefaultExportExportProgressCollectionName, query).then(response => {
      return {
        response
      };
    });
  }
  handleExport(req) {
    const databaseController = req.config.database;
    const emailControllerAdapter = (0, _AdapterLoader.loadAdapter)(req.config.emailAdapter);
    if (!emailControllerAdapter) {
      return Promise.reject(new Error('You have to setup a Mail Adapter.'));
    }
    const exportProgress = {
      id: req.body.name,
      masterKey: req.info.masterKey,
      applicationId: req.info.appId
    };
    databaseController.create(DefaultExportExportProgressCollectionName, exportProgress).then(() => {
      return databaseController.loadSchema({
        clearCache: true
      });
    }).then(schemaController => schemaController.getOneSchema(req.body.name, true)).then(schema => {
      const classNames = [req.body.name];
      Object.keys(schema.fields).forEach(fieldName => {
        const field = schema.fields[fieldName];
        if (field.type === 'Relation') {
          classNames.push(`_Join:${fieldName}:${req.body.name}`);
        }
      });
      const promisses = classNames.map(name => {
        return this.exportClass(req, {
          name
        });
      });
      return Promise.all(promisses);
    }).then(jsonFiles => {
      return new Promise(resolve => {
        const tmpZipFile = _tmp.default.fileSync();
        const tmpZipStream = _fs.default.createWriteStream(tmpZipFile.name);
        const zip = (0, _archiver.default)('zip');
        zip.pipe(tmpZipStream);
        jsonFiles.forEach(tmpJsonFile => {
          zip.append(_fs.default.readFileSync(tmpJsonFile.name), {
            name: tmpJsonFile._name
          });
          tmpJsonFile.removeCallback();
        });
        zip.finalize();
        tmpZipStream.on('close', () => {
          const buf = _fs.default.readFileSync(tmpZipFile.name);
          tmpZipFile.removeCallback();
          resolve(buf);
        });
      });
    }).then(zippedFile => {
      const filesController = req.config.filesController;
      return filesController.createFile(req.config, req.body.name, zippedFile, 'application/zip');
    }).then(fileData => {
      return emailControllerAdapter.sendMail({
        text: `We have successfully exported your data from the class ${req.body.name}.\n
        Please download from ${fileData.url}`,
        link: fileData.url,
        to: req.body.feedbackEmail,
        subject: 'Export completed'
      });
    }).catch(error => {
      return emailControllerAdapter.sendMail({
        text: `We could not export your data to the class ${req.body.name}. Error: ${error}`,
        to: req.body.feedbackEmail,
        subject: 'Export failed'
      });
    }).then(() => {
      return databaseController.destroy(DefaultExportExportProgressCollectionName, exportProgress);
    });
    return Promise.resolve({
      response: 'We are exporting your data. You will be notified by e-mail once it is completed.'
    });
  }
  mountRoutes() {
    this.route('PUT', '/export_data', req => {
      return this.handleExport(req);
    });
    this.route('GET', '/export_progress', req => {
      return this.handleExportProgress(req);
    });
  }
}
exports.ExportRouter = ExportRouter;
var _default = exports.default = ExportRouter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfUHJvbWlzZVJvdXRlciIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0FkYXB0ZXJMb2FkZXIiLCJfcmVzdCIsIl9hcmNoaXZlciIsIl90bXAiLCJfZnMiLCJlIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJEZWZhdWx0RXhwb3J0RXhwb3J0UHJvZ3Jlc3NDb2xsZWN0aW9uTmFtZSIsInJlbGF0aW9uU2NoZW1hIiwiZmllbGRzIiwicmVsYXRlZElkIiwidHlwZSIsIm93bmluZ0lkIiwiRXhwb3J0Um91dGVyIiwiUHJvbWlzZVJvdXRlciIsImV4cG9ydENsYXNzUGFnZSIsInJlcSIsImNsYXNzTmFtZSIsImpzb25GaWxlU3RyZWFtIiwid2hlcmUiLCJza2lwIiwibGltaXQiLCJkYXRhYmFzZUNvbnRyb2xsZXIiLCJjb25maWciLCJkYXRhYmFzZSIsIm9wdGlvbnMiLCJmaW5kUHJvbWlzZSIsImluZGV4T2YiLCJhZGFwdGVyIiwiZmluZCIsInJlc3QiLCJhdXRoIiwidGhlbiIsImRhdGEiLCJBcnJheSIsImlzQXJyYXkiLCJyZXN1bHRzIiwibWFwIiwib2JqIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJrZXkiLCJzdGFydHNXaXRoIiwibGVuZ3RoIiwid3JpdGUiLCJKU09OIiwic3RyaW5naWZ5Iiwic3Vic3RyIiwic2xpY2UiLCJleHBvcnRDbGFzcyIsInRtcEpzb25GaWxlIiwidG1wIiwiZmlsZVN5bmMiLCJmcyIsImNyZWF0ZVdyaXRlU3RyZWFtIiwibmFtZSIsImhhc0pvaW4iLCJjb3VudCIsInJlc3VsdCIsIk51bWJlciIsImlzSW50ZWdlciIsImkiLCJwYWdlTGltaXQiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJlbmQiLCJvbiIsIl9uYW1lIiwicmVwbGFjZSIsImhhbmRsZUV4cG9ydFByb2dyZXNzIiwicXVlcnkiLCJtYXN0ZXJLZXkiLCJpbmZvIiwiYXBwbGljYXRpb25JZCIsImFwcElkIiwicmVzcG9uc2UiLCJoYW5kbGVFeHBvcnQiLCJlbWFpbENvbnRyb2xsZXJBZGFwdGVyIiwibG9hZEFkYXB0ZXIiLCJlbWFpbEFkYXB0ZXIiLCJyZWplY3QiLCJFcnJvciIsImV4cG9ydFByb2dyZXNzIiwiaWQiLCJib2R5IiwiY3JlYXRlIiwibG9hZFNjaGVtYSIsImNsZWFyQ2FjaGUiLCJzY2hlbWFDb250cm9sbGVyIiwiZ2V0T25lU2NoZW1hIiwic2NoZW1hIiwiY2xhc3NOYW1lcyIsImZpZWxkTmFtZSIsImZpZWxkIiwicHVzaCIsInByb21pc3NlcyIsImFsbCIsImpzb25GaWxlcyIsInRtcFppcEZpbGUiLCJ0bXBaaXBTdHJlYW0iLCJ6aXAiLCJhcmNoaXZlciIsInBpcGUiLCJhcHBlbmQiLCJyZWFkRmlsZVN5bmMiLCJyZW1vdmVDYWxsYmFjayIsImZpbmFsaXplIiwiYnVmIiwiemlwcGVkRmlsZSIsImZpbGVzQ29udHJvbGxlciIsImNyZWF0ZUZpbGUiLCJmaWxlRGF0YSIsInNlbmRNYWlsIiwidGV4dCIsInVybCIsImxpbmsiLCJ0byIsImZlZWRiYWNrRW1haWwiLCJzdWJqZWN0IiwiY2F0Y2giLCJlcnJvciIsImRlc3Ryb3kiLCJtb3VudFJvdXRlcyIsInJvdXRlIiwiZXhwb3J0cyIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL1JvdXRlcnMvRXhwb3J0Um91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9taXNlUm91dGVyIGZyb20gJy4uL1Byb21pc2VSb3V0ZXInO1xuaW1wb3J0IHsgbG9hZEFkYXB0ZXIgfSBmcm9tICcuLi9BZGFwdGVycy9BZGFwdGVyTG9hZGVyJztcbmltcG9ydCByZXN0IGZyb20gJy4uL3Jlc3QnO1xuaW1wb3J0IGFyY2hpdmVyIGZyb20gJ2FyY2hpdmVyJztcbmltcG9ydCB0bXAgZnJvbSAndG1wJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5cbmNvbnN0IERlZmF1bHRFeHBvcnRFeHBvcnRQcm9ncmVzc0NvbGxlY3Rpb25OYW1lID0gJ19FeHBvcnRQcm9ncmVzcyc7XG5jb25zdCByZWxhdGlvblNjaGVtYSA9IHtcbiAgZmllbGRzOiB7IHJlbGF0ZWRJZDogeyB0eXBlOiAnU3RyaW5nJyB9LCBvd25pbmdJZDogeyB0eXBlOiAnU3RyaW5nJyB9IH0sXG59O1xuXG5leHBvcnQgY2xhc3MgRXhwb3J0Um91dGVyIGV4dGVuZHMgUHJvbWlzZVJvdXRlciB7XG4gIGV4cG9ydENsYXNzUGFnZShyZXEsIGNsYXNzTmFtZSwganNvbkZpbGVTdHJlYW0sIHdoZXJlLCBza2lwLCBsaW1pdCkge1xuICAgIGNvbnN0IGRhdGFiYXNlQ29udHJvbGxlciA9IHJlcS5jb25maWcuZGF0YWJhc2U7XG5cbiAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgc2tpcCxcbiAgICAgIGxpbWl0LFxuICAgIH07XG5cbiAgICBjb25zdCBmaW5kUHJvbWlzZSA9XG4gICAgICBjbGFzc05hbWUuaW5kZXhPZignX0pvaW4nKSA9PT0gMFxuICAgICAgICA/IGRhdGFiYXNlQ29udHJvbGxlci5hZGFwdGVyLmZpbmQoXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICAgIHJlbGF0aW9uU2NoZW1hLFxuICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKVxuICAgICAgICA6IHJlc3QuZmluZChyZXEuY29uZmlnLCByZXEuYXV0aCwgY2xhc3NOYW1lLCB3aGVyZSwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gZmluZFByb21pc2UudGhlbihkYXRhID0+IHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGRhdGEpKSB7XG4gICAgICAgIGRhdGEgPSB7XG4gICAgICAgICAgcmVzdWx0czogZGF0YS5tYXAob2JqID0+IHtcbiAgICAgICAgICAgIC8vIE5lZWRlZCB0byBhdm9pZCBlcnJvcnMgZHVyaW5nIGltcG9ydC5cbiAgICAgICAgICAgIC8vIFNlZSBtb3JlOiBodHRwczovL2RvY3MucGFyc2VwbGF0Zm9ybS5vcmcvanMvZ3VpZGUvI2Vycm9yLWNvZGVzXG5cbiAgICAgICAgICAgIC8vIERlbGV0ZXMgaW52YWxpZCBrZXlzIGluIG9yZGVyIHRvIGF2b2lkIFwiUGFyc2VFcnJvcjogMTA1IEludmFsaWQgZmllbGQgbmFtZVwiXG4gICAgICAgICAgICAvLyB3aGVuIGltcG9ydGluZ1xuICAgICAgICAgICAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgnXycpKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIG9ialtrZXldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGlmIChza2lwICYmIGRhdGEucmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAganNvbkZpbGVTdHJlYW0ud3JpdGUoJyxcXG4nKTtcbiAgICAgIH1cblxuICAgICAganNvbkZpbGVTdHJlYW0ud3JpdGUoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KGRhdGEucmVzdWx0cywgbnVsbCwgMilcbiAgICAgICAgICAuc3Vic3RyKDEpXG4gICAgICAgICAgLnNsaWNlKDAsIC0xKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIGV4cG9ydENsYXNzKHJlcSwgZGF0YSkge1xuICAgIGNvbnN0IGRhdGFiYXNlQ29udHJvbGxlciA9IHJlcS5jb25maWcuZGF0YWJhc2U7XG4gICAgY29uc3QgdG1wSnNvbkZpbGUgPSB0bXAuZmlsZVN5bmMoKTtcbiAgICBjb25zdCBqc29uRmlsZVN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKHRtcEpzb25GaWxlLm5hbWUpO1xuXG4gICAganNvbkZpbGVTdHJlYW0ud3JpdGUoJ3tcXG5cInJlc3VsdHNcIiA6IFtcXG4nKTtcbiAgICBjb25zdCBoYXNKb2luID0gZGF0YS5uYW1lLmluZGV4T2YoJ19Kb2luJykgPT09IDA7XG4gICAgbGV0IGZpbmRQcm9taXNlID0gbnVsbDtcbiAgICBpZiAoaGFzSm9pbikge1xuICAgICAgZmluZFByb21pc2UgPSBkYXRhYmFzZUNvbnRyb2xsZXIuYWRhcHRlci5jb3VudChcbiAgICAgICAgZGF0YS5uYW1lLFxuICAgICAgICByZWxhdGlvblNjaGVtYSxcbiAgICAgICAgZGF0YS53aGVyZVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmluZFByb21pc2UgPSByZXN0LmZpbmQocmVxLmNvbmZpZywgcmVxLmF1dGgsIGRhdGEubmFtZSwgZGF0YS53aGVyZSwge1xuICAgICAgICBjb3VudDogdHJ1ZSxcbiAgICAgICAgbGltaXQ6IDAsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmluZFByb21pc2VcbiAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKHJlc3VsdCkpIHtcbiAgICAgICAgICByZXN1bHQgPSB7IGNvdW50OiByZXN1bHQgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgY29uc3QgcGFnZUxpbWl0ID0gMTAwMDtcbiAgICAgICAgbGV0IHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTtcblxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcmVzdWx0LmNvdW50OyBpICs9IHBhZ2VMaW1pdCkge1xuICAgICAgICAgIGNvbnN0IHNraXAgPSBpO1xuICAgICAgICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXhwb3J0Q2xhc3NQYWdlKFxuICAgICAgICAgICAgICByZXEsXG4gICAgICAgICAgICAgIGRhdGEubmFtZSxcbiAgICAgICAgICAgICAganNvbkZpbGVTdHJlYW0sXG4gICAgICAgICAgICAgIGRhdGEud2hlcmUsXG4gICAgICAgICAgICAgIHNraXAsXG4gICAgICAgICAgICAgIHBhZ2VMaW1pdFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAganNvbkZpbGVTdHJlYW0uZW5kKCddXFxufScpO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICBqc29uRmlsZVN0cmVhbS5vbignY2xvc2UnLCAoKSA9PiB7XG4gICAgICAgICAgICB0bXBKc29uRmlsZS5fbmFtZSA9IGAke2RhdGEubmFtZS5yZXBsYWNlKC86L2csICfqnoknKX0uanNvbmA7XG5cbiAgICAgICAgICAgIHJlc29sdmUodG1wSnNvbkZpbGUpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlRXhwb3J0UHJvZ3Jlc3MocmVxKSB7XG4gICAgY29uc3QgZGF0YWJhc2VDb250cm9sbGVyID0gcmVxLmNvbmZpZy5kYXRhYmFzZTtcblxuICAgIGNvbnN0IHF1ZXJ5ID0ge1xuICAgICAgbWFzdGVyS2V5OiByZXEuaW5mby5tYXN0ZXJLZXksXG4gICAgICBhcHBsaWNhdGlvbklkOiByZXEuaW5mby5hcHBJZCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRhdGFiYXNlQ29udHJvbGxlclxuICAgICAgLmZpbmQoRGVmYXVsdEV4cG9ydEV4cG9ydFByb2dyZXNzQ29sbGVjdGlvbk5hbWUsIHF1ZXJ5KVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICByZXR1cm4geyByZXNwb25zZSB9O1xuICAgICAgfSk7XG4gIH1cblxuICBoYW5kbGVFeHBvcnQocmVxKSB7XG4gICAgY29uc3QgZGF0YWJhc2VDb250cm9sbGVyID0gcmVxLmNvbmZpZy5kYXRhYmFzZTtcblxuICAgIGNvbnN0IGVtYWlsQ29udHJvbGxlckFkYXB0ZXIgPSBsb2FkQWRhcHRlcihyZXEuY29uZmlnLmVtYWlsQWRhcHRlcik7XG5cbiAgICBpZiAoIWVtYWlsQ29udHJvbGxlckFkYXB0ZXIpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoJ1lvdSBoYXZlIHRvIHNldHVwIGEgTWFpbCBBZGFwdGVyLicpKTtcbiAgICB9XG5cbiAgICBjb25zdCBleHBvcnRQcm9ncmVzcyA9IHtcbiAgICAgIGlkOiByZXEuYm9keS5uYW1lLFxuICAgICAgbWFzdGVyS2V5OiByZXEuaW5mby5tYXN0ZXJLZXksXG4gICAgICBhcHBsaWNhdGlvbklkOiByZXEuaW5mby5hcHBJZCxcbiAgICB9O1xuXG4gICAgZGF0YWJhc2VDb250cm9sbGVyXG4gICAgICAuY3JlYXRlKERlZmF1bHRFeHBvcnRFeHBvcnRQcm9ncmVzc0NvbGxlY3Rpb25OYW1lLCBleHBvcnRQcm9ncmVzcylcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIGRhdGFiYXNlQ29udHJvbGxlci5sb2FkU2NoZW1hKHsgY2xlYXJDYWNoZTogdHJ1ZSB9KTtcbiAgICAgIH0pXG4gICAgICAudGhlbihzY2hlbWFDb250cm9sbGVyID0+XG4gICAgICAgIHNjaGVtYUNvbnRyb2xsZXIuZ2V0T25lU2NoZW1hKHJlcS5ib2R5Lm5hbWUsIHRydWUpXG4gICAgICApXG4gICAgICAudGhlbihzY2hlbWEgPT4ge1xuICAgICAgICBjb25zdCBjbGFzc05hbWVzID0gW3JlcS5ib2R5Lm5hbWVdO1xuICAgICAgICBPYmplY3Qua2V5cyhzY2hlbWEuZmllbGRzKS5mb3JFYWNoKGZpZWxkTmFtZSA9PiB7XG4gICAgICAgICAgY29uc3QgZmllbGQgPSBzY2hlbWEuZmllbGRzW2ZpZWxkTmFtZV07XG5cbiAgICAgICAgICBpZiAoZmllbGQudHlwZSA9PT0gJ1JlbGF0aW9uJykge1xuICAgICAgICAgICAgY2xhc3NOYW1lcy5wdXNoKGBfSm9pbjoke2ZpZWxkTmFtZX06JHtyZXEuYm9keS5uYW1lfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcHJvbWlzc2VzID0gY2xhc3NOYW1lcy5tYXAobmFtZSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZXhwb3J0Q2xhc3MocmVxLCB7IG5hbWUgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNzZXMpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGpzb25GaWxlcyA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICBjb25zdCB0bXBaaXBGaWxlID0gdG1wLmZpbGVTeW5jKCk7XG4gICAgICAgICAgY29uc3QgdG1wWmlwU3RyZWFtID0gZnMuY3JlYXRlV3JpdGVTdHJlYW0odG1wWmlwRmlsZS5uYW1lKTtcblxuICAgICAgICAgIGNvbnN0IHppcCA9IGFyY2hpdmVyKCd6aXAnKTtcbiAgICAgICAgICB6aXAucGlwZSh0bXBaaXBTdHJlYW0pO1xuXG4gICAgICAgICAganNvbkZpbGVzLmZvckVhY2godG1wSnNvbkZpbGUgPT4ge1xuICAgICAgICAgICAgemlwLmFwcGVuZChmcy5yZWFkRmlsZVN5bmModG1wSnNvbkZpbGUubmFtZSksIHtcbiAgICAgICAgICAgICAgbmFtZTogdG1wSnNvbkZpbGUuX25hbWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRtcEpzb25GaWxlLnJlbW92ZUNhbGxiYWNrKCk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB6aXAuZmluYWxpemUoKTtcblxuICAgICAgICAgIHRtcFppcFN0cmVhbS5vbignY2xvc2UnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBidWYgPSBmcy5yZWFkRmlsZVN5bmModG1wWmlwRmlsZS5uYW1lKTtcbiAgICAgICAgICAgIHRtcFppcEZpbGUucmVtb3ZlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgIHJlc29sdmUoYnVmKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oemlwcGVkRmlsZSA9PiB7XG4gICAgICAgIGNvbnN0IGZpbGVzQ29udHJvbGxlciA9IHJlcS5jb25maWcuZmlsZXNDb250cm9sbGVyO1xuICAgICAgICByZXR1cm4gZmlsZXNDb250cm9sbGVyLmNyZWF0ZUZpbGUoXG4gICAgICAgICAgcmVxLmNvbmZpZyxcbiAgICAgICAgICByZXEuYm9keS5uYW1lLFxuICAgICAgICAgIHppcHBlZEZpbGUsXG4gICAgICAgICAgJ2FwcGxpY2F0aW9uL3ppcCdcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgICAudGhlbihmaWxlRGF0YSA9PiB7XG4gICAgICAgIHJldHVybiBlbWFpbENvbnRyb2xsZXJBZGFwdGVyLnNlbmRNYWlsKHtcbiAgICAgICAgICB0ZXh0OiBgV2UgaGF2ZSBzdWNjZXNzZnVsbHkgZXhwb3J0ZWQgeW91ciBkYXRhIGZyb20gdGhlIGNsYXNzICR7cmVxLmJvZHkubmFtZX0uXFxuXG4gICAgICAgIFBsZWFzZSBkb3dubG9hZCBmcm9tICR7ZmlsZURhdGEudXJsfWAsXG4gICAgICAgICAgbGluazogZmlsZURhdGEudXJsLFxuICAgICAgICAgIHRvOiByZXEuYm9keS5mZWVkYmFja0VtYWlsLFxuICAgICAgICAgIHN1YmplY3Q6ICdFeHBvcnQgY29tcGxldGVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgcmV0dXJuIGVtYWlsQ29udHJvbGxlckFkYXB0ZXIuc2VuZE1haWwoe1xuICAgICAgICAgIHRleHQ6IGBXZSBjb3VsZCBub3QgZXhwb3J0IHlvdXIgZGF0YSB0byB0aGUgY2xhc3MgJHtyZXEuYm9keS5uYW1lfS4gRXJyb3I6ICR7ZXJyb3J9YCxcbiAgICAgICAgICB0bzogcmVxLmJvZHkuZmVlZGJhY2tFbWFpbCxcbiAgICAgICAgICBzdWJqZWN0OiAnRXhwb3J0IGZhaWxlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIGRhdGFiYXNlQ29udHJvbGxlci5kZXN0cm95KFxuICAgICAgICAgIERlZmF1bHRFeHBvcnRFeHBvcnRQcm9ncmVzc0NvbGxlY3Rpb25OYW1lLFxuICAgICAgICAgIGV4cG9ydFByb2dyZXNzXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgcmVzcG9uc2U6XG4gICAgICAgICdXZSBhcmUgZXhwb3J0aW5nIHlvdXIgZGF0YS4gWW91IHdpbGwgYmUgbm90aWZpZWQgYnkgZS1tYWlsIG9uY2UgaXQgaXMgY29tcGxldGVkLicsXG4gICAgfSk7XG4gIH1cblxuICBtb3VudFJvdXRlcygpIHtcbiAgICB0aGlzLnJvdXRlKCdQVVQnLCAnL2V4cG9ydF9kYXRhJywgcmVxID0+IHtcbiAgICAgIHJldHVybiB0aGlzLmhhbmRsZUV4cG9ydChyZXEpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5yb3V0ZSgnR0VUJywgJy9leHBvcnRfcHJvZ3Jlc3MnLCByZXEgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRXhwb3J0UHJvZ3Jlc3MocmVxKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFeHBvcnRSb3V0ZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLGNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLGNBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLEtBQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLFNBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLElBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLEdBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUFvQixTQUFBRCx1QkFBQU8sQ0FBQSxXQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUMsVUFBQSxHQUFBRCxDQUFBLEtBQUFFLE9BQUEsRUFBQUYsQ0FBQTtBQUVwQixNQUFNRyx5Q0FBeUMsR0FBRyxpQkFBaUI7QUFD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Q0FBQ3NFLElBQUksQ0FBQzlCLElBQUksRUFDYnNELFVBQVUsRUFDVixpQkFDRixDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQ0Q5RSxJQUFJLENBQUNpRixRQUFRLElBQUk7TUFDaEIsT0FBT2xDLHNCQUFzQixDQUFDbUMsUUFBUSxDQUFDO1FBQ3JDQyxJQUFJLEVBQUUsMERBQTBEbkcsR0FBRyxDQUFDc0UsSUFBSSxDQUFDOUIsSUFBSTtBQUN2RiwrQkFBK0J5RCxRQUFRLENBQUNHLEdBQUcsRUFBRTtRQUNuQ0MsSUFBSSxFQUFFSixRQUFRLENBQUNHLEdBQUc7UUFDbEJFLEVBQUUsRUFBRXRHLEdBQUcsQ0FBQ3NFLElBQUksQ0FBQ2lDLGFBQWE7UUFDMUJDLE9BQU8sRUFBRTtNQUNYLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUNEQyxLQUFLLENBQUNDLEtBQUssSUFBSTtNQUNkLE9BQU8zQyxzQkFBc0IsQ0FBQ21DLFFBQVEsQ0FBQztRQUNyQ0MsSUFBSSxFQUFFLDhDQUE4Q25HLEdBQUcsQ0FBQ3NFLElBQUksQ0FBQzlCLElBQUksWUFBWWtFLEtBQUssRUFBRTtRQUNwRkosRUFBRSxFQUFFdEcsR0FBRyxDQUFDc0UsSUFBSSxDQUFDaUMsYUFBYTtRQUMxQkMsT0FBTyxFQUFFO01BQ1gsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQ0R4RixJQUFJLENBQUMsTUFBTTtNQUNWLE9BQU9WLGtCQUFrQixDQUFDcUcsT0FBTyxDQUMvQnBILHlDQUF5QyxFQUN6QzZFLGNBQ0YsQ0FBQztJQUNILENBQUMsQ0FBQztJQUVKLE9BQU9uQixPQUFPLENBQUNDLE9BQU8sQ0FBQztNQUNyQlcsUUFBUSxFQUNOO0lBQ0osQ0FBQyxDQUFDO0VBQ0o7RUFFQStDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsS0FBSyxDQUFDLEtBQUssRUFBRSxjQUFjLEVBQUU3RyxHQUFHLElBQUk7TUFDdkMsT0FBTyxJQUFJLENBQUM4RCxZQUFZLENBQUM5RCxHQUFHLENBQUM7SUFDL0IsQ0FBQyxDQUFDO0lBRUYsSUFBSSxDQUFDNkcsS0FBSyxDQUFDLEtBQUssRUFBRSxrQkFBa0IsRUFBRTdHLEdBQUcsSUFBSTtNQUMzQyxPQUFPLElBQUksQ0FBQ3VELG9CQUFvQixDQUFDdkQsR0FBRyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQztFQUNKO0FBQ0Y7QUFBQzhHLE9BQUEsQ0FBQWpILFlBQUEsR0FBQUEsWUFBQTtBQUFBLElBQUFrSCxRQUFBLEdBQUFELE9BQUEsQ0FBQXhILE9BQUEsR0FFY08sWUFBWSIsImlnbm9yZUxpc3QiOltdfQ==