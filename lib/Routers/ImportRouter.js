"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ImportRouter = void 0;
var _express = _interopRequireDefault(require("express"));
var _AdapterLoader = require("../Adapters/AdapterLoader");
var middlewares = _interopRequireWildcard(require("../middlewares"));
var _multer = _interopRequireDefault(require("multer"));
var _rest = _interopRequireDefault(require("../rest"));
var _node = require("parse/node");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
class ImportRouter {
  getOneSchema(req) {
    const className = req.params.className;
    return req.config.database.loadSchema({
      clearCache: true
    }).then(schemaController => schemaController.getOneSchema(className)).catch(error => {
      if (error === undefined) {
        return Promise.reject(new _node.Parse.Error(_node.Parse.Error.INVALID_CLASS_NAME, `Class ${className} does not exist.`));
      } else {
        return Promise.reject(new _node.Parse.Error(_node.Parse.Error.INTERNAL_SERVER_ERROR, 'Database adapter error.'));
      }
    });
  }
  importRestObject(req, restObject, targetClass) {
    if (targetClass) {
      return _rest.default.update(req.config, req.auth, req.params.className, {
        objectId: restObject.owningId
      }, {
        [req.params.relationName]: {
          __op: 'AddRelation',
          objects: [{
            __type: 'Pointer',
            className: targetClass,
            objectId: restObject.relatedId
          }]
        }
      }, req.info.clientSDK).catch(function (error) {
        if (error.code === _node.Parse.Error.OBJECT_NOT_FOUND) {
          return Promise.reject(new _node.Parse.Error(_node.Parse.Error.OBJECT_NOT_FOUND, 'Object not found'));
        } else {
          return Promise.reject(error);
        }
      });
    }
    if (restObject.createdAt) {
      delete restObject.createdAt;
    }
    if (restObject.updatedAt) {
      delete restObject.updatedAt;
    }
    if (restObject.objectId) {
      restObject.id = restObject.objectId;
      delete restObject.objectId;
    }
    if (restObject.id) {
      return _rest.default.update(req.config, req.auth, req.params.className, {
        objectId: restObject.objectId
      }, restObject, req.info.clientSDK).catch(function (error) {
        if (error.code === _node.Parse.Error.OBJECT_NOT_FOUND) {
          return _rest.default.create(req.config, req.auth, req.params.className, restObject, req.info.clientSDK, {
            allowObjectId: true
          });
        } else {
          return Promise.reject(error);
        }
      });
    }
    return _rest.default.create(req.config, req.auth, req.params.className, restObject);
  }
  getRestObjects(req) {
    return new Promise(resolve => {
      let restObjects = [];
      let importFile;
      try {
        importFile = JSON.parse(req.file.buffer.toString());
      } catch (e) {
        throw new Error('Failed to parse JSON based on the file sent');
      }
      if (Array.isArray(importFile)) {
        restObjects = importFile;
      } else if (Array.isArray(importFile.results)) {
        restObjects = importFile.results;
      } else if (Array.isArray(importFile.rows)) {
        restObjects = importFile.rows;
      }
      if (!restObjects) {
        throw new Error('No data to import');
      }
      if (req.body.feedbackEmail) {
        if (!req.config.emailAdapter) {
          throw new Error('You have to setup a Mail Adapter.');
        }
      }
      resolve(restObjects);
    });
  }
  handleImport(req) {
    const emailControllerAdapter = (0, _AdapterLoader.loadAdapter)(req.config.emailAdapter);
    let promise = null;
    if (req.params.relationName) {
      promise = this.getOneSchema(req).then(response => {
        if (!Object.prototype.hasOwnProperty.call(response.fields, req.params.relationName)) {
          throw new Error(`Relation ${req.params.relationName} does not exist in ${req.params.className}.`);
        } else if (response.fields[req.params.relationName].type !== 'Relation') {
          throw new Error(`Class ${response.fields[req.params.relationName].targetClass} does not have Relation type.`);
        }
        const targetClass = response.fields[req.params.relationName].targetClass;
        return Promise.all([this.getRestObjects(req), targetClass]);
      });
    } else {
      promise = Promise.all([this.getRestObjects(req)]);
    }
    promise = promise.then(([restObjects, targetClass]) => {
      return restObjects.reduce((item, object, index) => {
        item.pageArray.push(this.importRestObject.bind(this, req, object, targetClass));
        if (index && index % 100 === 0 || index === restObjects.length - 1) {
          const pageArray = item.pageArray.slice(0);
          item.pageArray = [];
          item.mainPromise = item.mainPromise.then(results => {
            return Promise.all(results.concat(pageArray.map(func => func())));
          });
        }
        return item;
      }, {
        pageArray: [],
        mainPromise: Promise.resolve([])
      }).mainPromise;
    }).then(results => {
      if (req.body.feedbackEmail) {
        emailControllerAdapter.sendMail({
          text: `We have successfully imported your data to the class ${req.params.className}${req.params.relationName ? ', relation ' + req.params.relationName : ''}.`,
          to: req.body.feedbackEmail,
          subject: 'Import completed'
        });
      } else {
        return Promise.resolve({
          response: results
        });
      }
    }).catch(error => {
      if (req.body.feedbackEmail) {
        emailControllerAdapter.sendMail({
          text: `We could not import your data to the class ${req.params.className}${req.params.relationName ? ', relation ' + req.params.relationName : ''}. Error: ${error}`,
          to: req.body.feedbackEmail,
          subject: 'Import failed'
        });
      } else {
        throw new Error('Internal server error: ' + error);
      }
    });
    if (req.body.feedbackEmail && emailControllerAdapter) {
      promise = Promise.resolve({
        response: 'We are importing your data. You will be notified by e-mail once it is completed.'
      });
    }
    return promise;
  }
  wrapPromiseRequest(req, res, handler) {
    return handler(req).then(data => {
      res.json(data);
    }).catch(err => {
      res.status(400).send({
        message: err.message
      });
    });
  }
  expressRouter() {
    const router = _express.default.Router();
    const upload = (0, _multer.default)();
    router.post('/import_data/:className', upload.single('importFile'),
    // middlewares.allowCrossDomain,
    middlewares.handleParseHeaders, middlewares.enforceMasterKeyAccess, (req, res) => this.wrapPromiseRequest(req, res, this.handleImport.bind(this)));
    router.post('/import_relation_data/:className/:relationName', upload.single('importFile'),
    // middlewares.allowCrossDomain,
    middlewares.handleParseHeaders, middlewares.enforceMasterKeyAccess, (req, res) => this.wrapPromiseRequest(req, res, this.handleImport.bind(this)));
    return router;
  }
}
exports.ImportRouter = ImportRouter;
var _default = exports.default = ImportRouter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0FkYXB0ZXJMb2FkZXIiLCJtaWRkbGV3YXJlcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX211bHRlciIsIl9yZXN0IiwiX25vZGUiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJlIiwiV2Vha01hcCIsInIiLCJ0IiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJoYXMiLCJnZXQiLCJuIiwiX19wcm90b19fIiwiYSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwidSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImkiLCJzZXQiLCJJbXBvcnRSb3V0ZXIiLCJnZXRPbmVTY2hlbWEiLCJyZXEiLCJjbGFzc05hbWUiLCJwYXJhbXMiLCJjb25maWciLCJkYXRhYmFzZSIsImxvYWRTY2hlbWEiLCJjbGVhckNhY2hlIiwidGhlbiIsInNjaGVtYUNvbnRyb2xsZXIiLCJjYXRjaCIsImVycm9yIiwidW5kZWZpbmVkIiwiUHJvbWlzZSIsInJlamVjdCIsIlBhcnNlIiwiRXJyb3IiLCJJTlZBTElEX0NMQVNTX05BTUUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJpbXBvcnRSZXN0T2JqZWN0IiwicmVzdE9iamVjdCIsInRhcmdldENsYXNzIiwicmVzdCIsInVwZGF0ZSIsImF1dGgiLCJvYmplY3RJZCIsIm93bmluZ0lkIiwicmVsYXRpb25OYW1lIiwiX19vcCIsIm9iamVjdHMiLCJfX3R5cGUiLCJyZWxhdGVkSWQiLCJpbmZvIiwiY2xpZW50U0RLIiwiY29kZSIsIk9CSkVDVF9OT1RfRk9VTkQiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJpZCIsImNyZWF0ZSIsImFsbG93T2JqZWN0SWQiLCJnZXRSZXN0T2JqZWN0cyIsInJlc29sdmUiLCJyZXN0T2JqZWN0cyIsImltcG9ydEZpbGUiLCJKU09OIiwicGFyc2UiLCJmaWxlIiwiYnVmZmVyIiwidG9TdHJpbmciLCJBcnJheSIsImlzQXJyYXkiLCJyZXN1bHRzIiwicm93cyIsImJvZHkiLCJmZWVkYmFja0VtYWlsIiwiZW1haWxBZGFwdGVyIiwiaGFuZGxlSW1wb3J0IiwiZW1haWxDb250cm9sbGVyQWRhcHRlciIsImxvYWRBZGFwdGVyIiwicHJvbWlzZSIsInJlc3BvbnNlIiwicHJvdG90eXBlIiwiZmllbGRzIiwidHlwZSIsImFsbCIsInJlZHVjZSIsIml0ZW0iLCJvYmplY3QiLCJpbmRleCIsInBhZ2VBcnJheSIsInB1c2giLCJiaW5kIiwibGVuZ3RoIiwic2xpY2UiLCJtYWluUHJvbWlzZSIsImNvbmNhdCIsIm1hcCIsImZ1bmMiLCJzZW5kTWFpbCIsInRleHQiLCJ0byIsInN1YmplY3QiLCJ3cmFwUHJvbWlzZVJlcXVlc3QiLCJyZXMiLCJoYW5kbGVyIiwiZGF0YSIsImpzb24iLCJlcnIiLCJzdGF0dXMiLCJzZW5kIiwibWVzc2FnZSIsImV4cHJlc3NSb3V0ZXIiLCJyb3V0ZXIiLCJleHByZXNzIiwiUm91dGVyIiwidXBsb2FkIiwibXVsdGVyIiwicG9zdCIsInNpbmdsZSIsImhhbmRsZVBhcnNlSGVhZGVycyIsImVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MiLCJleHBvcnRzIiwiX2RlZmF1bHQiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvUm91dGVycy9JbXBvcnRSb3V0ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBsb2FkQWRhcHRlciB9IGZyb20gJy4uL0FkYXB0ZXJzL0FkYXB0ZXJMb2FkZXInO1xuaW1wb3J0ICogYXMgbWlkZGxld2FyZXMgZnJvbSAnLi4vbWlkZGxld2FyZXMnO1xuaW1wb3J0IG11bHRlciBmcm9tICdtdWx0ZXInO1xuaW1wb3J0IHJlc3QgZnJvbSAnLi4vcmVzdCc7XG5pbXBvcnQgeyBQYXJzZSB9IGZyb20gJ3BhcnNlL25vZGUnO1xuXG5leHBvcnQgY2xhc3MgSW1wb3J0Um91dGVyIHtcbiAgZ2V0T25lU2NoZW1hKHJlcSkge1xuICAgIGNvbnN0IGNsYXNzTmFtZSA9IHJlcS5wYXJhbXMuY2xhc3NOYW1lO1xuXG4gICAgcmV0dXJuIHJlcS5jb25maWcuZGF0YWJhc2VcbiAgICAgIC5sb2FkU2NoZW1hKHsgY2xlYXJDYWNoZTogdHJ1ZSB9KVxuICAgICAgLnRoZW4oc2NoZW1hQ29udHJvbGxlciA9PiBzY2hlbWFDb250cm9sbGVyLmdldE9uZVNjaGVtYShjbGFzc05hbWUpKVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgaWYgKGVycm9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoXG4gICAgICAgICAgICBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgICAgICAgIFBhcnNlLkVycm9yLklOVkFMSURfQ0xBU1NfTkFNRSxcbiAgICAgICAgICAgICAgYENsYXNzICR7Y2xhc3NOYW1lfSBkb2VzIG5vdCBleGlzdC5gXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoXG4gICAgICAgICAgICBuZXcgUGFyc2UuRXJyb3IoXG4gICAgICAgICAgICAgIFBhcnNlLkVycm9yLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICAgICAgICAgJ0RhdGFiYXNlIGFkYXB0ZXIgZXJyb3IuJ1xuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgaW1wb3J0UmVzdE9iamVjdChyZXEsIHJlc3RPYmplY3QsIHRhcmdldENsYXNzKSB7XG4gICAgaWYgKHRhcmdldENsYXNzKSB7XG4gICAgICByZXR1cm4gcmVzdFxuICAgICAgICAudXBkYXRlKFxuICAgICAgICAgIHJlcS5jb25maWcsXG4gICAgICAgICAgcmVxLmF1dGgsXG4gICAgICAgICAgcmVxLnBhcmFtcy5jbGFzc05hbWUsXG4gICAgICAgICAgeyBvYmplY3RJZDogcmVzdE9iamVjdC5vd25pbmdJZCB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFtyZXEucGFyYW1zLnJlbGF0aW9uTmFtZV06IHtcbiAgICAgICAgICAgICAgX19vcDogJ0FkZFJlbGF0aW9uJyxcbiAgICAgICAgICAgICAgb2JqZWN0czogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIF9fdHlwZTogJ1BvaW50ZXInLFxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiB0YXJnZXRDbGFzcyxcbiAgICAgICAgICAgICAgICAgIG9iamVjdElkOiByZXN0T2JqZWN0LnJlbGF0ZWRJZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlcS5pbmZvLmNsaWVudFNES1xuICAgICAgICApXG4gICAgICAgIC5jYXRjaChmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSBQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5EKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoXG4gICAgICAgICAgICAgIG5ldyBQYXJzZS5FcnJvcihQYXJzZS5FcnJvci5PQkpFQ1RfTk9UX0ZPVU5ELCAnT2JqZWN0IG5vdCBmb3VuZCcpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHJlc3RPYmplY3QuY3JlYXRlZEF0KSB7XG4gICAgICBkZWxldGUgcmVzdE9iamVjdC5jcmVhdGVkQXQ7XG4gICAgfVxuXG4gICAgaWYgKHJlc3RPYmplY3QudXBkYXRlZEF0KSB7XG4gICAgICBkZWxldGUgcmVzdE9iamVjdC51cGRhdGVkQXQ7XG4gICAgfVxuXG4gICAgaWYgKHJlc3RPYmplY3Qub2JqZWN0SWQpIHtcbiAgICAgIHJlc3RPYmplY3QuaWQgPSByZXN0T2JqZWN0Lm9iamVjdElkO1xuICAgICAgZGVsZXRlIHJlc3RPYmplY3Qub2JqZWN0SWQ7XG4gICAgfVxuXG4gICAgaWYgKHJlc3RPYmplY3QuaWQpIHtcbiAgICAgIHJldHVybiByZXN0XG4gICAgICAgIC51cGRhdGUoXG4gICAgICAgICAgcmVxLmNvbmZpZyxcbiAgICAgICAgICByZXEuYXV0aCxcbiAgICAgICAgICByZXEucGFyYW1zLmNsYXNzTmFtZSxcbiAgICAgICAgICB7IG9iamVjdElkOiByZXN0T2JqZWN0Lm9iamVjdElkIH0sXG4gICAgICAgICAgcmVzdE9iamVjdCxcbiAgICAgICAgICByZXEuaW5mby5jbGllbnRTREtcbiAgICAgICAgKVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3QuY3JlYXRlKFxuICAgICAgICAgICAgICByZXEuY29uZmlnLFxuICAgICAgICAgICAgICByZXEuYXV0aCxcbiAgICAgICAgICAgICAgcmVxLnBhcmFtcy5jbGFzc05hbWUsXG4gICAgICAgICAgICAgIHJlc3RPYmplY3QsXG4gICAgICAgICAgICAgIHJlcS5pbmZvLmNsaWVudFNESyxcbiAgICAgICAgICAgICAgeyBhbGxvd09iamVjdElkOiB0cnVlIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdC5jcmVhdGUocmVxLmNvbmZpZywgcmVxLmF1dGgsIHJlcS5wYXJhbXMuY2xhc3NOYW1lLCByZXN0T2JqZWN0KTtcbiAgfVxuXG4gIGdldFJlc3RPYmplY3RzKHJlcSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIGxldCByZXN0T2JqZWN0cyA9IFtdO1xuICAgICAgbGV0IGltcG9ydEZpbGU7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGltcG9ydEZpbGUgPSBKU09OLnBhcnNlKHJlcS5maWxlLmJ1ZmZlci50b1N0cmluZygpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gcGFyc2UgSlNPTiBiYXNlZCBvbiB0aGUgZmlsZSBzZW50Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGltcG9ydEZpbGUpKSB7XG4gICAgICAgIHJlc3RPYmplY3RzID0gaW1wb3J0RmlsZTtcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShpbXBvcnRGaWxlLnJlc3VsdHMpKSB7XG4gICAgICAgIHJlc3RPYmplY3RzID0gaW1wb3J0RmlsZS5yZXN1bHRzO1xuICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGltcG9ydEZpbGUucm93cykpIHtcbiAgICAgICAgcmVzdE9iamVjdHMgPSBpbXBvcnRGaWxlLnJvd3M7XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzdE9iamVjdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBkYXRhIHRvIGltcG9ydCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVxLmJvZHkuZmVlZGJhY2tFbWFpbCkge1xuICAgICAgICBpZiAoIXJlcS5jb25maWcuZW1haWxBZGFwdGVyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgaGF2ZSB0byBzZXR1cCBhIE1haWwgQWRhcHRlci4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXNvbHZlKHJlc3RPYmplY3RzKTtcbiAgICB9KTtcbiAgfVxuXG4gIGhhbmRsZUltcG9ydChyZXEpIHtcbiAgICBjb25zdCBlbWFpbENvbnRyb2xsZXJBZGFwdGVyID0gbG9hZEFkYXB0ZXIocmVxLmNvbmZpZy5lbWFpbEFkYXB0ZXIpO1xuXG4gICAgbGV0IHByb21pc2UgPSBudWxsO1xuXG4gICAgaWYgKHJlcS5wYXJhbXMucmVsYXRpb25OYW1lKSB7XG4gICAgICBwcm9taXNlID0gdGhpcy5nZXRPbmVTY2hlbWEocmVxKS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoXG4gICAgICAgICAgICByZXNwb25zZS5maWVsZHMsXG4gICAgICAgICAgICByZXEucGFyYW1zLnJlbGF0aW9uTmFtZVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYFJlbGF0aW9uICR7cmVxLnBhcmFtcy5yZWxhdGlvbk5hbWV9IGRvZXMgbm90IGV4aXN0IGluICR7cmVxLnBhcmFtcy5jbGFzc05hbWV9LmBcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIHJlc3BvbnNlLmZpZWxkc1tyZXEucGFyYW1zLnJlbGF0aW9uTmFtZV0udHlwZSAhPT0gJ1JlbGF0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgQ2xhc3MgJHtyZXNwb25zZS5maWVsZHNbcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVdLnRhcmdldENsYXNzfSBkb2VzIG5vdCBoYXZlIFJlbGF0aW9uIHR5cGUuYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0YXJnZXRDbGFzcyA9XG4gICAgICAgICAgcmVzcG9uc2UuZmllbGRzW3JlcS5wYXJhbXMucmVsYXRpb25OYW1lXS50YXJnZXRDbGFzcztcblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0UmVzdE9iamVjdHMocmVxKSwgdGFyZ2V0Q2xhc3NdKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcm9taXNlID0gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0UmVzdE9iamVjdHMocmVxKV0pO1xuICAgIH1cblxuICAgIHByb21pc2UgPSBwcm9taXNlXG4gICAgICAudGhlbigoW3Jlc3RPYmplY3RzLCB0YXJnZXRDbGFzc10pID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc3RPYmplY3RzLnJlZHVjZShcbiAgICAgICAgICAoaXRlbSwgb2JqZWN0LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaXRlbS5wYWdlQXJyYXkucHVzaChcbiAgICAgICAgICAgICAgdGhpcy5pbXBvcnRSZXN0T2JqZWN0LmJpbmQodGhpcywgcmVxLCBvYmplY3QsIHRhcmdldENsYXNzKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAoaW5kZXggJiYgaW5kZXggJSAxMDAgPT09IDApIHx8XG4gICAgICAgICAgICAgIGluZGV4ID09PSByZXN0T2JqZWN0cy5sZW5ndGggLSAxXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgY29uc3QgcGFnZUFycmF5ID0gaXRlbS5wYWdlQXJyYXkuc2xpY2UoMCk7XG4gICAgICAgICAgICAgIGl0ZW0ucGFnZUFycmF5ID0gW107XG5cbiAgICAgICAgICAgICAgaXRlbS5tYWluUHJvbWlzZSA9IGl0ZW0ubWFpblByb21pc2UudGhlbihyZXN1bHRzID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgICAgICAgICAgICAgICByZXN1bHRzLmNvbmNhdChwYWdlQXJyYXkubWFwKGZ1bmMgPT4gZnVuYygpKSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7IHBhZ2VBcnJheTogW10sIG1haW5Qcm9taXNlOiBQcm9taXNlLnJlc29sdmUoW10pIH1cbiAgICAgICAgKS5tYWluUHJvbWlzZTtcbiAgICAgIH0pXG4gICAgICAudGhlbihyZXN1bHRzID0+IHtcbiAgICAgICAgaWYgKHJlcS5ib2R5LmZlZWRiYWNrRW1haWwpIHtcbiAgICAgICAgICBlbWFpbENvbnRyb2xsZXJBZGFwdGVyLnNlbmRNYWlsKHtcbiAgICAgICAgICAgIHRleHQ6IGBXZSBoYXZlIHN1Y2Nlc3NmdWxseSBpbXBvcnRlZCB5b3VyIGRhdGEgdG8gdGhlIGNsYXNzICR7XG4gICAgICAgICAgICAgIHJlcS5wYXJhbXMuY2xhc3NOYW1lXG4gICAgICAgICAgICB9JHtcbiAgICAgICAgICAgICAgcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVcbiAgICAgICAgICAgICAgICA/ICcsIHJlbGF0aW9uICcgKyByZXEucGFyYW1zLnJlbGF0aW9uTmFtZVxuICAgICAgICAgICAgICAgIDogJydcbiAgICAgICAgICAgIH0uYCxcbiAgICAgICAgICAgIHRvOiByZXEuYm9keS5mZWVkYmFja0VtYWlsLFxuICAgICAgICAgICAgc3ViamVjdDogJ0ltcG9ydCBjb21wbGV0ZWQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoeyByZXNwb25zZTogcmVzdWx0cyB9KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGlmIChyZXEuYm9keS5mZWVkYmFja0VtYWlsKSB7XG4gICAgICAgICAgZW1haWxDb250cm9sbGVyQWRhcHRlci5zZW5kTWFpbCh7XG4gICAgICAgICAgICB0ZXh0OiBgV2UgY291bGQgbm90IGltcG9ydCB5b3VyIGRhdGEgdG8gdGhlIGNsYXNzICR7XG4gICAgICAgICAgICAgIHJlcS5wYXJhbXMuY2xhc3NOYW1lXG4gICAgICAgICAgICB9JHtcbiAgICAgICAgICAgICAgcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVcbiAgICAgICAgICAgICAgICA/ICcsIHJlbGF0aW9uICcgKyByZXEucGFyYW1zLnJlbGF0aW9uTmFtZVxuICAgICAgICAgICAgICAgIDogJydcbiAgICAgICAgICAgIH0uIEVycm9yOiAke2Vycm9yfWAsXG4gICAgICAgICAgICB0bzogcmVxLmJvZHkuZmVlZGJhY2tFbWFpbCxcbiAgICAgICAgICAgIHN1YmplY3Q6ICdJbXBvcnQgZmFpbGVkJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludGVybmFsIHNlcnZlciBlcnJvcjogJyArIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICBpZiAocmVxLmJvZHkuZmVlZGJhY2tFbWFpbCAmJiBlbWFpbENvbnRyb2xsZXJBZGFwdGVyKSB7XG4gICAgICBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgcmVzcG9uc2U6XG4gICAgICAgICAgJ1dlIGFyZSBpbXBvcnRpbmcgeW91ciBkYXRhLiBZb3Ugd2lsbCBiZSBub3RpZmllZCBieSBlLW1haWwgb25jZSBpdCBpcyBjb21wbGV0ZWQuJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBwcm9taXNlO1xuICB9XG5cbiAgd3JhcFByb21pc2VSZXF1ZXN0KHJlcSwgcmVzLCBoYW5kbGVyKSB7XG4gICAgcmV0dXJuIGhhbmRsZXIocmVxKVxuICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIHJlcy5qc29uKGRhdGEpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnIgPT4ge1xuICAgICAgICByZXMuc3RhdHVzKDQwMCkuc2VuZCh7IG1lc3NhZ2U6IGVyci5tZXNzYWdlIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBleHByZXNzUm91dGVyKCkge1xuICAgIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG4gICAgY29uc3QgdXBsb2FkID0gbXVsdGVyKCk7XG5cbiAgICByb3V0ZXIucG9zdChcbiAgICAgICcvaW1wb3J0X2RhdGEvOmNsYXNzTmFtZScsXG4gICAgICB1cGxvYWQuc2luZ2xlKCdpbXBvcnRGaWxlJyksXG4gICAgICAvLyBtaWRkbGV3YXJlcy5hbGxvd0Nyb3NzRG9tYWluLFxuICAgICAgbWlkZGxld2FyZXMuaGFuZGxlUGFyc2VIZWFkZXJzLFxuICAgICAgbWlkZGxld2FyZXMuZW5mb3JjZU1hc3RlcktleUFjY2VzcyxcbiAgICAgIChyZXEsIHJlcykgPT5cbiAgICAgICAgdGhpcy53cmFwUHJvbWlzZVJlcXVlc3QocmVxLCByZXMsIHRoaXMuaGFuZGxlSW1wb3J0LmJpbmQodGhpcykpXG4gICAgKTtcblxuICAgIHJvdXRlci5wb3N0KFxuICAgICAgJy9pbXBvcnRfcmVsYXRpb25fZGF0YS86Y2xhc3NOYW1lLzpyZWxhdGlvbk5hbWUnLFxuICAgICAgdXBsb2FkLnNpbmdsZSgnaW1wb3J0RmlsZScpLFxuICAgICAgLy8gbWlkZGxld2FyZXMuYWxsb3dDcm9zc0RvbWFpbixcbiAgICAgIG1pZGRsZXdhcmVzLmhhbmRsZVBhcnNlSGVhZGVycyxcbiAgICAgIG1pZGRsZXdhcmVzLmVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MsXG4gICAgICAocmVxLCByZXMpID0+XG4gICAgICAgIHRoaXMud3JhcFByb21pc2VSZXF1ZXN0KHJlcSwgcmVzLCB0aGlzLmhhbmRsZUltcG9ydC5iaW5kKHRoaXMpKVxuICAgICk7XG5cbiAgICByZXR1cm4gcm91dGVyO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEltcG9ydFJvdXRlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsY0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsV0FBQSxHQUFBQyx1QkFBQSxDQUFBSCxPQUFBO0FBQ0EsSUFBQUksT0FBQSxHQUFBTCxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUssS0FBQSxHQUFBTixzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQU0sS0FBQSxHQUFBTixPQUFBO0FBQW1DLFNBQUFPLHlCQUFBQyxDQUFBLDZCQUFBQyxPQUFBLG1CQUFBQyxDQUFBLE9BQUFELE9BQUEsSUFBQUUsQ0FBQSxPQUFBRixPQUFBLFlBQUFGLHdCQUFBLFlBQUFBLENBQUFDLENBQUEsV0FBQUEsQ0FBQSxHQUFBRyxDQUFBLEdBQUFELENBQUEsS0FBQUYsQ0FBQTtBQUFBLFNBQUFMLHdCQUFBSyxDQUFBLEVBQUFFLENBQUEsU0FBQUEsQ0FBQSxJQUFBRixDQUFBLElBQUFBLENBQUEsQ0FBQUksVUFBQSxTQUFBSixDQUFBLGVBQUFBLENBQUEsdUJBQUFBLENBQUEseUJBQUFBLENBQUEsV0FBQUssT0FBQSxFQUFBTCxDQUFBLFFBQUFHLENBQUEsR0FBQUosd0JBQUEsQ0FBQUcsQ0FBQSxPQUFBQyxDQUFBLElBQUFBLENBQUEsQ0FBQUcsR0FBQSxDQUFBTixDQUFBLFVBQUFHLENBQUEsQ0FBQUksR0FBQSxDQUFBUCxDQUFBLE9BQUFRLENBQUEsS0FBQUMsU0FBQSxVQUFBQyxDQUFBLEdBQUFDLE1BQUEsQ0FBQUMsY0FBQSxJQUFBRCxNQUFBLENBQUFFLHdCQUFBLFdBQUFDLENBQUEsSUFBQWQsQ0FBQSxvQkFBQWMsQ0FBQSxPQUFBQyxjQUFBLENBQUFDLElBQUEsQ0FBQWhCLENBQUEsRUFBQWMsQ0FBQSxTQUFBRyxDQUFBLEdBQUFQLENBQUEsR0FBQUMsTUFBQSxDQUFBRSx3QkFBQSxDQUFBYixDQUFBLEVBQUFjLENBQUEsVUFBQUcsQ0FBQSxLQUFBQSxDQUFBLENBQUFWLEdBQUEsSUFBQVUsQ0FBQSxDQUFBQyxHQUFBLElBQUFQLE1BQUEsQ0FBQUMsY0FBQSxDQUFBSixDQUFBLEVBQUFNLENBQUEsRUFBQUcsQ0FBQSxJQUFBVCxDQUFBLENBQUFNLENBQUEsSUFBQWQsQ0FBQSxDQUFBYyxDQUFBLFlBQUFOLENBQUEsQ0FBQUgsT0FBQSxHQUFBTCxDQUFBLEVBQUFHLENBQUEsSUFBQUEsQ0FBQSxDQUFBZSxHQUFBLENBQUFsQixDQUFBLEVBQUFRLENBQUEsR0FBQUEsQ0FBQTtBQUFBLFNBQUFqQix1QkFBQVMsQ0FBQSxXQUFBQSxDQUFBLElBQUFBLENBQUEsQ0FBQUksVUFBQSxHQUFBSixDQUFBLEtBQUFLLE9BQUEsRUFBQUwsQ0FBQTtBQUU1QixNQUFNbUIsWUFBWSxDQUFDO0VBQ3hCQyxZQUFZQSxDQUFDQyxHQUFHLEVBQUU7SUFDaEIsTUFBTUMsU0FBUyxHQUFHRCxHQUFHLENBQUNFLE1BQU0sQ0FBQ0QsU0FBUztJQUV0QyxPQUFPRCxHQUFHLENBQUNHLE1BQU0sQ0FBQ0MsUUFBUSxDQUN2QkMsVUFBVSxDQUFDO01BQUVDLFVBQVUsRUFBRTtJQUFLLENBQUMsQ0FBQyxDQUNoQ0MsSUFBSSxDQUFDQyxnQkFBZ0IsSUFBSUEsZ0JBQWdCLENBQUNULFlBQVksQ0FBQ0UsU0FBUyxDQUFDLENBQUMsQ0FDbEVRLEtBQUssQ0FBQ0MsS0FBSyxJQUFJO01BQ2QsSUFBSUEsS0FBSyxLQUFLQyxTQUFTLEVBQUU7UUFDdkIsT0FBT0MsT0FBTyxDQUFDQyxNQUFNLENBQ25CLElBQUlDLFdBQUssQ0FBQ0MsS0FBSyxDQUNiRCxXQUFLLENBQUNDLEtBQUssQ0FBQ0Msa0JBQWtCLEVBQzlCLFNBQVNmLFNBQVMsa0JBQ3BCLENBQ0YsQ0FBQztNQUNILENBQUMsTUFBTTtRQUNMLE9BQU9XLE9BQU8sQ0FBQ0MsTUFBTSxDQUNuQixJQUFJQyxXQUFLLENBQUNDLEtBQUssQ0FDYkQsV0FBSyxDQUFDQyxLQUFLLENBQUNFLHFCQUFxQixFQUNqQyx5QkFDRixDQUNGLENBQUM7TUFDSDtJQUNGLENBQUMsQ0FBQztFQUNOO0VBRUFDLGdCQUFnQkEsQ0FBQ2xCLEdBQUcsRUFBRW1CLFVBQVUsRUFBRUMsV0FBVyxFQUFFO0lBQzdDLElBQUlBLFdBQVcsRUFBRTtNQUNmLE9BQU9DLGFBQUksQ0FDUkMsTUFBTSxDQUNMdEIsR0FBRyxDQUFDRyxNQUFNLEVBQ1ZILEdBQUcsQ0FBQ3VCLElBQUksRUFDUnZCLEdBQUcsQ0FBQ0UsTUFBTSxDQUFDRCxTQUFTLEVBQ3BCO1FBQUV1QixRQUFRLEVBQUVMLFVBQVUsQ0FBQ007TUFBUyxDQUFDLEVBQ2pDO1FBQ0UsQ0FBQ3pCLEdBQUcsQ0FBQ0UsTUFBTSxDQUFDd0IsWUFBWSxHQUFHO1VBQ3pCQyxJQUFJLEVBQUUsYUFBYTtVQUNuQkMsT0FBTyxFQUFFLENBQ1A7WUFDRUMsTUFBTSxFQUFFLFNBQVM7WUFDakI1QixTQUFTLEVBQUVtQixXQUFXO1lBQ3RCSSxRQUFRLEVBQUVMLFVBQVUsQ0FBQ1c7VUFDdkIsQ0FBQztRQUVMO01BQ0YsQ0FBQyxFQUNEOUIsR0FBRyxDQUFDK0IsSUFBSSxDQUFDQyxTQUNYLENBQUMsQ0FDQXZCLEtBQUssQ0FBQyxVQUFTQyxLQUFLLEVBQUU7UUFDckIsSUFBSUEsS0FBSyxDQUFDdUIsSUFBSSxLQUFLbkIsV0FBSyxDQUFDQyxLQUFLLENBQUNtQixnQkFBZ0IsRUFBRTtVQUMvQyxPQUFPdEIsT0FBTyxDQUFDQyxNQUFNLENBQ25CLElBQUlDLFdBQUssQ0FBQ0MsS0FBSyxDQUFDRCxXQUFLLENBQUNDLEtBQUssQ0FBQ21CLGdCQUFnQixFQUFFLGtCQUFrQixDQUNsRSxDQUFDO1FBQ0gsQ0FBQyxNQUFNO1VBQ0wsT0FBT3RCLE9BQU8sQ0FBQ0MsTUFBTSxDQUFDSCxLQUFLLENBQUM7UUFDOUI7TUFDRixDQUFDLENBQUM7SUFDTjtJQUVBLElBQUlTLFVBQVUsQ0FBQ2dCLFNBQVMsRUFBRTtNQUN4QixPQUFPaEIsVUFBVSxDQUFDZ0IsU0FBUztJQUM3QjtJQUVBLElBQUloQixVQUFVLENBQUNpQixTQUFTLEVBQUU7TUFDeEIsT0FBT2pCLFVBQVUsQ0FBQ2lCLFNBQVM7SUFDN0I7SUFFQSxJQUFJakIsVUFBVSxDQUFDSyxRQUFRLEVBQUU7TUFDdkJMLFVBQVUsQ0FBQ2tCLEVBQUUsR0FBR2xCLFVBQVUsQ0FBQ0ssUUFBUTtNQUNuQyxPQUFPTCxVQUFVLENBQUNLLFFBQVE7SUFDNUI7SUFFQSxJQUFJTCxVQUFVLENBQUNrQixFQUFFLEVBQUU7TUFDakIsT0FBT2hCLGFBQUksQ0FDUkMsTUFBTSxDQUNMdEIsR0FBRyxDQUFDRyxNQUFNLEVBQ1ZILEdBQUcsQ0FBQ3VCLElBQUksRUFDUnZCLEdBQUcsQ0FBQ0UsTUFBTSxDQUFDRCxTQUFTLEVBQ3BCO1FBQUV1QixRQUFRLEVBQUVMLFVBQVUsQ0FBQ0s7TUFBUyxDQUFDLEVBQ2pDTCxVQUFVLEVBQ1ZuQixHQUFHLENBQUMrQixJQUFJLENBQUNDLFNBQ1gsQ0FBQyxDQUNBdkIsS0FBSyxDQUFDLFVBQVNDLEtBQUssRUFBRTtRQUNyQixJQUFJQSxLQUFLLENBQUN1QixJQUFJLEtBQUtuQixXQUFLLENBQUNDLEtBQUssQ0FBQ21CLGdCQUFnQixFQUFFO1VBQy9DLE9BQU9iLGFBQUksQ0FBQ2lCLE1BQU0sQ0FDaEJ0QyxHQUFHLENBQUNHLE1BQU0sRUFDVkgsR0FBRyxDQUFDdUIsSUFBSSxFQUNSdkIsR0FBRyxDQUFDRSxNQUFNLENBQUNELFNBQVMsRUFDcEJrQixVQUFVLEVBQ1ZuQixHQUFHLENBQUMrQixJQUFJLENBQUNDLFNBQVMsRUFDbEI7WUFBRU8sYUFBYSxFQUFFO1VBQUssQ0FDeEIsQ0FBQztRQUNILENBQUMsTUFBTTtVQUNMLE9BQU8zQixPQUFPLENBQUNDLE1BQU0sQ0FBQ0gsS0FBSyxDQUFDO1FBQzlCO01BQ0YsQ0FBQyxDQUFDO0lBQ047SUFFQSxPQUFPVyxhQUFJLENBQUNpQixNQUFNLENBQUN0QyxHQUFHLENBQUNHLE1BQU0sRUFBRUgsR0FBRyxDQUFDdUIsSUFBSSxFQUFFdkIsR0FBRyxDQUFDRSxNQUFNLENBQUNELFNBQVMsRUFBRWtCLFVBQVUsQ0FBQztFQUM1RTtFQUVBcUIsY0FBY0EsQ0FBQ3hDLEdBQUcsRUFBRTtJQUNsQixPQUFPLElBQUlZLE9BQU8sQ0FBQzZCLE9BQU8sSUFBSTtNQUM1QixJQUFJQyxXQUFXLEdBQUcsRUFBRTtNQUNwQixJQUFJQyxVQUFVO01BRWQsSUFBSTtRQUNGQSxVQUFVLEdBQUdDLElBQUksQ0FBQ0MsS0FBSyxDQUFDN0MsR0FBRyxDQUFDOEMsSUFBSSxDQUFDQyxNQUFNLENBQUNDLFFBQVEsQ0FBQyxDQUFDLENBQUM7TUFDckQsQ0FBQyxDQUFDLE9BQU9yRSxDQUFDLEVBQUU7UUFDVixNQUFNLElBQUlvQyxLQUFLLENBQUMsNkNBQTZDLENBQUM7TUFDaEU7TUFFQSxJQUFJa0MsS0FBSyxDQUFDQyxPQUFPLENBQUNQLFVBQVUsQ0FBQyxFQUFFO1FBQzdCRCxXQUFXLEdBQUdDLFVBQVU7TUFDMUIsQ0FBQyxNQUFNLElBQUlNLEtBQUssQ0FBQ0MsT0FBTyxDQUFDUCxVQUFVLENBQUNRLE9BQU8sQ0FBQyxFQUFFO1FBQzVDVCxXQUFXLEdBQUdDLFVBQVUsQ0FBQ1EsT0FBTztNQUNsQyxDQUFDLE1BQU0sSUFBSUYsS0FBSyxDQUFDQyxPQUFPLENBQUNQLFVBQVUsQ0FBQ1MsSUFBSSxDQUFDLEVBQUU7UUFDekNWLFdBQVcsR0FBR0MsVUFBVSxDQUFDUyxJQUFJO01BQy9CO01BRUEsSUFBSSxDQUFDVixXQUFXLEVBQUU7UUFDaEIsTUFBTSxJQUFJM0IsS0FBSyxDQUFDLG1CQUFtQixDQUFDO01BQ3RDO01BRUEsSUFBSWYsR0FBRyxDQUFDcUQsSUFBSSxDQUFDQyxhQUFhLEVBQUU7UUFDMUIsSUFBSSxDQUFDdEQsR0FBRyxDQUFDRyxNQUFNLENBQUNvRCxZQUFZLEVBQUU7VUFDNUIsTUFBTSxJQUFJeEMsS0FBSyxDQUFDLG1DQUFtQyxDQUFDO1FBQ3REO01BQ0Y7TUFFQTBCLE9BQU8sQ0FBQ0MsV0FBVyxDQUFDO0lBQ3RCLENBQUMsQ0FBQztFQUNKO0VBRUFjLFlBQVlBLENBQUN4RCxHQUFHLEVBQUU7SUFDaEIsTUFBTXlELHNCQUFzQixHQUFHLElBQUFDLDBCQUFXLEVBQUMxRCxHQUFHLENBQUNHLE1BQU0sQ0FBQ29ELFlBQVksQ0FBQztJQUVuRSxJQUFJSSxPQUFPLEdBQUcsSUFBSTtJQUVsQixJQUFJM0QsR0FBRyxDQUFDRSxNQUFNLENBQUN3QixZQUFZLEVBQUU7TUFDM0JpQyxPQUFPLEdBQUcsSUFBSSxDQUFDNUQsWUFBWSxDQUFDQyxHQUFHLENBQUMsQ0FBQ08sSUFBSSxDQUFDcUQsUUFBUSxJQUFJO1FBQ2hELElBQ0UsQ0FBQ3RFLE1BQU0sQ0FBQ3VFLFNBQVMsQ0FBQ25FLGNBQWMsQ0FBQ0MsSUFBSSxDQUNuQ2lFLFFBQVEsQ0FBQ0UsTUFBTSxFQUNmOUQsR0FBRyxDQUFDRSxNQUFNLENBQUN3QixZQUNiLENBQUMsRUFDRDtVQUNBLE1BQU0sSUFBSVgsS0FBSyxDQUNiLFlBQVlmLEdBQUcsQ0FBQ0UsTUFBTSxDQUFDd0IsWUFBWSxzQkFBc0IxQixHQUFHLENBQUNFLE1BQU0sQ0FBQ0QsU0FBUyxHQUMvRSxDQUFDO1FBQ0gsQ0FBQyxNQUFNLElBQ0wyRCxRQUFRLENBQUNFLE1BQU0sQ0FBQzlELEdBQUcsQ0FBQ0UsTUFBTSxDQUFDd0IsWUFBWSxDQUFDLENBQUNxQyxJQUFJLEtBQUssVUFBVSxFQUM1RDtVQUNBLE1BQU0sSUFBSWhELEtBQUssQ0FDYixTQUFTNkMsUUFBUSxDQUFDRSxNQUFNLENBQUM5RCxHQUFHLENBQUNFLE1BQU0sQ0FBQ3dCLFlBQVksQ0FBQyxDQUFDTixXQUFXLCtCQUMvRCxDQUFDO1FBQ0g7UUFFQSxNQUFNQSxXQUFXLEdBQ2Z3QyxRQUFRLENBQUNFLE1BQU0sQ0FBQzlELEdBQUcsQ0FBQ0UsTUFBTSxDQUFDd0IsWUFBWSxDQUFDLENBQUNOLFdBQVc7UUFFdEQsT0FBT1IsT0FBTyxDQUFDb0QsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDeEIsY0FBYyxDQUFDeEMsR0FBRyxDQUFDLEVBQUVvQixXQUFXLENBQUMsQ0FBQztNQUM3RCxDQUFDLENBQUM7SUFDSixDQUFDLE1BQU07TUFDTHVDLE9BQU8sR0FBRy9DLE9BQU8sQ0FBQ29ELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQ3hCLGNBQWMsQ0FBQ3hDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDbkQ7SUFFQTJELE9BQU8sR0FBR0EsT0FBTyxDQUNkcEQsSUFBSSxDQUFDLENBQUMsQ0FBQ21DLFdBQVcsRUFBRXRCLFdBQVcsQ0FBQyxLQUFLO01BQ3BDLE9BQU9zQixXQUFXLENBQUN1QixNQUFNLENBQ3ZCLENBQUNDLElBQUksRUFBRUMsTUFBTSxFQUFFQyxLQUFLLEtBQUs7UUFDdkJGLElBQUksQ0FBQ0csU0FBUyxDQUFDQyxJQUFJLENBQ2pCLElBQUksQ0FBQ3BELGdCQUFnQixDQUFDcUQsSUFBSSxDQUFDLElBQUksRUFBRXZFLEdBQUcsRUFBRW1FLE1BQU0sRUFBRS9DLFdBQVcsQ0FDM0QsQ0FBQztRQUVELElBQ0dnRCxLQUFLLElBQUlBLEtBQUssR0FBRyxHQUFHLEtBQUssQ0FBQyxJQUMzQkEsS0FBSyxLQUFLMUIsV0FBVyxDQUFDOEIsTUFBTSxHQUFHLENBQUMsRUFDaEM7VUFDQSxNQUFNSCxTQUFTLEdBQUdILElBQUksQ0FBQ0csU0FBUyxDQUFDSSxLQUFLLENBQUMsQ0FBQyxDQUFDO1VBQ3pDUCxJQUFJLENBQUNHLFNBQVMsR0FBRyxFQUFFO1VBRW5CSCxJQUFJLENBQUNRLFdBQVcsR0FBR1IsSUFBSSxDQUFDUSxXQUFXLENBQUNuRSxJQUFJLENBQUM0QyxPQUFPLElBQUk7WUFDbEQsT0FBT3ZDLE9BQU8sQ0FBQ29ELEdBQUcsQ0FDaEJiLE9BQU8sQ0FBQ3dCLE1BQU0sQ0FBQ04sU0FBUyxDQUFDTyxHQUFHLENBQUNDLElBQUksSUFBSUEsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUM5QyxDQUFDO1VBQ0gsQ0FBQyxDQUFDO1FBQ0o7UUFFQSxPQUFPWCxJQUFJO01BQ2IsQ0FBQyxFQUNEO1FBQUVHLFNBQVMsRUFBRSxFQUFFO1FBQUVLLFdBQVcsRUFBRTlELE9BQU8sQ0FBQzZCLE9BQU8sQ0FBQyxFQUFFO01BQUUsQ0FDcEQsQ0FBQyxDQUFDaUMsV0FBVztJQUNmLENBQUMsQ0FBQyxDQUNEbkUsSUFBSSxDQUFDNEMsT0FBTyxJQUFJO01BQ2YsSUFBSW5ELEdBQUcsQ0FBQ3FELElBQUksQ0FBQ0MsYUFBYSxFQUFFO1FBQzFCRyxzQkFBc0IsQ0FBQ3FCLFFBQVEsQ0FBQztVQUM5QkMsSUFBSSxFQUFFLHdEQUNKL0UsR0FBRyxDQUFDRSxNQUFNLENBQUNELFNBQVMsR0FFcEJELEdBQUcsQ0FBQ0UsTUFBTSxDQUFDd0IsWUFBWSxHQUNuQixhQUFhLEdBQUcxQixHQUFHLENBQUNFLE1BQU0sQ0FBQ3dCLFlBQVksR0FDdkMsRUFBRSxHQUNMO1VBQ0hzRCxFQUFFLEVBQUVoRixHQUFHLENBQUNxRCxJQUFJLENBQUNDLGFBQWE7VUFDMUIyQixPQUFPLEVBQUU7UUFDWCxDQUFDLENBQUM7TUFDSixDQUFDLE1BQU07UUFDTCxPQUFPckUsT0FBTyxDQUFDNkIsT0FBTyxDQUFDO1VBQUVtQixRQUFRLEVBQUVUO1FBQVEsQ0FBQyxDQUFDO01BQy9DO0lBQ0YsQ0FBQyxDQUFDLENBQ0QxQyxLQUFLLENBQUNDLEtBQUssSUFBSTtNQUNkLElBQUlWLEdBQUcsQ0FBQ3FELElBQUksQ0FBQ0MsYUFBYSxFQUFFO1FBQzFCRyxzQkFBc0IsQ0FBQ3FCLFFBQVEsQ0FBQztVQUM5QkMsSUFBSSxFQUFFLDhDQUNKL0UsR0FBRyxDQUFDRSxNQUFNLENBQUNELFNBQVMsR0FFcEJELEdBQUcsQ0FBQ0UsTUFBTSxDQUFDd0IsWUFBWSxHQUNuQixhQUFhLEdBQUcxQixHQUFHLENBQUNFLE1BQU0sQ0FBQ3dCLFlBQVksR0FDdkMsRUFBRSxZQUNJaEIsS0FBSyxFQUFFO1VBQ25Cc0UsRUFBRSxFQUFFaEYsR0FBRyxDQUFDcUQsSUFBSSxDQUFDQyxhQUFhO1VBQzFCMkIsT0FBTyxFQUFFO1FBQ1gsQ0FBQyxDQUFDO01BQ0osQ0FBQyxNQUFNO1FBQ0wsTUFBTSxJQUFJbEUsS0FBSyxDQUFDLHlCQUF5QixHQUFHTCxLQUFLLENBQUM7TUFDcEQ7SUFDRixDQUFDLENBQUM7SUFFSixJQUFJVixHQUFHLENBQUNxRCxJQUFJLENBQUNDLGFBQWEsSUFBSUcsc0JBQXNCLEVBQUU7TUFDcERFLE9BQU8sR0FBRy9DLE9BQU8sQ0FBQzZCLE9BQU8sQ0FBQztRQUN4Qm1CLFFBQVEsRUFDTjtNQUNKLENBQUMsQ0FBQztJQUNKO0lBRUEsT0FBT0QsT0FBTztFQUNoQjtFQUVBdUIsa0JBQWtCQSxDQUFDbEYsR0FBRyxFQUFFbUYsR0FBRyxFQUFFQyxPQUFPLEVBQUU7SUFDcEMsT0FBT0EsT0FBTyxDQUFDcEYsR0FBRyxDQUFDLENBQ2hCTyxJQUFJLENBQUM4RSxJQUFJLElBQUk7TUFDWkYsR0FBRyxDQUFDRyxJQUFJLENBQUNELElBQUksQ0FBQztJQUNoQixDQUFDLENBQUMsQ0FDRDVFLEtBQUssQ0FBQzhFLEdBQUcsSUFBSTtNQUNaSixHQUFHLENBQUNLLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQUVDLE9BQU8sRUFBRUgsR0FBRyxDQUFDRztNQUFRLENBQUMsQ0FBQztJQUNoRCxDQUFDLENBQUM7RUFDTjtFQUVBQyxhQUFhQSxDQUFBLEVBQUc7SUFDZCxNQUFNQyxNQUFNLEdBQUdDLGdCQUFPLENBQUNDLE1BQU0sQ0FBQyxDQUFDO0lBQy9CLE1BQU1DLE1BQU0sR0FBRyxJQUFBQyxlQUFNLEVBQUMsQ0FBQztJQUV2QkosTUFBTSxDQUFDSyxJQUFJLENBQ1QseUJBQXlCLEVBQ3pCRixNQUFNLENBQUNHLE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDM0I7SUFDQTdILFdBQVcsQ0FBQzhILGtCQUFrQixFQUM5QjlILFdBQVcsQ0FBQytILHNCQUFzQixFQUNsQyxDQUFDcEcsR0FBRyxFQUFFbUYsR0FBRyxLQUNQLElBQUksQ0FBQ0Qsa0JBQWtCLENBQUNsRixHQUFHLEVBQUVtRixHQUFHLEVBQUUsSUFBSSxDQUFDM0IsWUFBWSxDQUFDZSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQ2xFLENBQUM7SUFFRHFCLE1BQU0sQ0FBQ0ssSUFBSSxDQUNULGdEQUFnRCxFQUNoREYsTUFBTSxDQUFDRyxNQUFNLENBQUMsWUFBWSxDQUFDO0lBQzNCO0lBQ0E3SCxXQUFXLENBQUM4SCxrQkFBa0IsRUFDOUI5SCxXQUFXLENBQUMrSCxzQkFBc0IsRUFDbEMsQ0FBQ3BHLEdBQUcsRUFBRW1GLEdBQUcsS0FDUCxJQUFJLENBQUNELGtCQUFrQixDQUFDbEYsR0FBRyxFQUFFbUYsR0FBRyxFQUFFLElBQUksQ0FBQzNCLFlBQVksQ0FBQ2UsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUNsRSxDQUFDO0lBRUQsT0FBT3FCLE1BQU07RUFDZjtBQUNGO0FBQUNTLE9BQUEsQ0FBQXZHLFlBQUEsR0FBQUEsWUFBQTtBQUFBLElBQUF3RyxRQUFBLEdBQUFELE9BQUEsQ0FBQXJILE9BQUEsR0FFY2MsWUFBWSIsImlnbm9yZUxpc3QiOltdfQ==