"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ImportRouter = void 0;
var _express = _interopRequireDefault(require("express"));
var _AdapterLoader = require("../Adapters/AdapterLoader");
var middlewares = _interopRequireWildcard(require("../middlewares"));
var _multer = _interopRequireDefault(require("multer"));
var _rest = _interopRequireDefault(require("../rest"));
var _node = require("parse/node");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
class ImportRouter {
  getOneSchema(req) {
    const className = req.params.className;
    return req.config.database.loadSchema({
      clearCache: true
    }).then(schemaController => schemaController.getOneSchema(className)).catch(error => {
      if (error === undefined) {
        return Promise.reject(new _node.Parse.Error(_node.Parse.Error.INVALID_CLASS_NAME, `Class ${className} does not exist.`));
      } else {
        return Promise.reject(new _node.Parse.Error(_node.Parse.Error.INTERNAL_SERVER_ERROR, 'Database adapter error.'));
      }
    });
  }
  importRestObject(req, restObject, targetClass) {
    if (targetClass) {
      return _rest.default.update(req.config, req.auth, req.params.className, {
        objectId: restObject.owningId
      }, {
        [req.params.relationName]: {
          __op: 'AddRelation',
          objects: [{
            __type: 'Pointer',
            className: targetClass,
            objectId: restObject.relatedId
          }]
        }
      }, req.info.clientSDK).catch(function (error) {
        if (error.code === _node.Parse.Error.OBJECT_NOT_FOUND) {
          return Promise.reject(new _node.Parse.Error(_node.Parse.Error.OBJECT_NOT_FOUND, 'Object not found'));
        } else {
          return Promise.reject(error);
        }
      });
    }
    if (restObject.createdAt) {
      delete restObject.createdAt;
    }
    if (restObject.updatedAt) {
      delete restObject.updatedAt;
    }
    if (restObject.objectId) {
      return _rest.default.update(req.config, req.auth, req.params.className, {
        objectId: restObject.objectId
      }, restObject, req.info.clientSDK).catch(function (error) {
        if (error.code === _node.Parse.Error.OBJECT_NOT_FOUND) {
          return _rest.default.create(req.config, req.auth, req.params.className, restObject, req.info.clientSDK, {
            allowObjectId: true
          });
        } else {
          return Promise.reject(error);
        }
      });
    }
    return _rest.default.create(req.config, req.auth, req.params.className, restObject);
  }
  getRestObjects(req) {
    return new Promise(resolve => {
      let restObjects = [];
      let importFile;
      try {
        importFile = JSON.parse(req.file.buffer.toString());
      } catch (e) {
        throw new Error('Failed to parse JSON based on the file sent');
      }
      if (Array.isArray(importFile)) {
        restObjects = importFile;
      } else if (Array.isArray(importFile.results)) {
        restObjects = importFile.results;
      } else if (Array.isArray(importFile.rows)) {
        restObjects = importFile.rows;
      }
      if (!restObjects) {
        throw new Error('No data to import');
      }
      if (req.body.feedbackEmail) {
        if (!req.config.emailAdapter) {
          throw new Error('You have to setup a Mail Adapter.');
        }
      }
      resolve(restObjects);
    });
  }
  handleImport(req) {
    const emailControllerAdapter = (0, _AdapterLoader.loadAdapter)(req.config.emailAdapter);
    let promise = null;
    if (req.params.relationName) {
      promise = this.getOneSchema(req).then(response => {
        if (!Object.prototype.hasOwnProperty.call(response.fields, req.params.relationName)) {
          throw new Error(`Relation ${req.params.relationName} does not exist in ${req.params.className}.`);
        } else if (response.fields[req.params.relationName].type !== 'Relation') {
          throw new Error(`Class ${response.fields[req.params.relationName].targetClass} does not have Relation type.`);
        }
        const targetClass = response.fields[req.params.relationName].targetClass;
        return Promise.all([this.getRestObjects(req), targetClass]);
      });
    } else {
      promise = Promise.all([this.getRestObjects(req)]);
    }
    promise = promise.then(([restObjects, targetClass]) => {
      return restObjects.reduce((item, object, index) => {
        item.pageArray.push(this.importRestObject.bind(this, req, object, targetClass));
        if (index && index % 100 === 0 || index === restObjects.length - 1) {
          const pageArray = item.pageArray.slice(0);
          item.pageArray = [];
          item.mainPromise = item.mainPromise.then(results => {
            return Promise.all(results.concat(pageArray.map(func => func())));
          });
        }
        return item;
      }, {
        pageArray: [],
        mainPromise: Promise.resolve([])
      }).mainPromise;
    }).then(results => {
      if (req.body.feedbackEmail) {
        emailControllerAdapter.sendMail({
          text: `We have successfully imported your data to the class ${req.params.className}${req.params.relationName ? ', relation ' + req.params.relationName : ''}.`,
          to: req.body.feedbackEmail,
          subject: 'Import completed'
        });
      } else {
        return Promise.resolve({
          response: results
        });
      }
    }).catch(error => {
      if (req.body.feedbackEmail) {
        emailControllerAdapter.sendMail({
          text: `We could not import your data to the class ${req.params.className}${req.params.relationName ? ', relation ' + req.params.relationName : ''}. Error: ${error}`,
          to: req.body.feedbackEmail,
          subject: 'Import failed'
        });
      } else {
        throw new Error('Internal server error: ' + error);
      }
    });
    if (req.body.feedbackEmail && emailControllerAdapter) {
      promise = Promise.resolve({
        response: 'We are importing your data. You will be notified by e-mail once it is completed.'
      });
    }
    return promise;
  }
  wrapPromiseRequest(req, res, handler) {
    return handler(req).then(data => {
      res.json(data);
    }).catch(err => {
      res.status(400).send({
        message: err.message
      });
    });
  }
  expressRouter() {
    const router = _express.default.Router();
    const upload = (0, _multer.default)();
    router.post('/import_data/:className', upload.single('importFile'),
    // middlewares.allowCrossDomain,
    middlewares.handleParseHeaders, middlewares.enforceMasterKeyAccess, (req, res) => this.wrapPromiseRequest(req, res, this.handleImport.bind(this)));
    router.post('/import_relation_data/:className/:relationName', upload.single('importFile'),
    // middlewares.allowCrossDomain,
    middlewares.handleParseHeaders, middlewares.enforceMasterKeyAccess, (req, res) => this.wrapPromiseRequest(req, res, this.handleImport.bind(this)));
    return router;
  }
}
exports.ImportRouter = ImportRouter;
var _default = exports.default = ImportRouter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0FkYXB0ZXJMb2FkZXIiLCJtaWRkbGV3YXJlcyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwiX211bHRlciIsIl9yZXN0IiwiX25vZGUiLCJfZ2V0UmVxdWlyZVdpbGRjYXJkQ2FjaGUiLCJlIiwiV2Vha01hcCIsInIiLCJ0IiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJoYXMiLCJnZXQiLCJuIiwiX19wcm90b19fIiwiYSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwidSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImkiLCJzZXQiLCJJbXBvcnRSb3V0ZXIiLCJnZXRPbmVTY2hlbWEiLCJyZXEiLCJjbGFzc05hbWUiLCJwYXJhbXMiLCJjb25maWciLCJkYXRhYmFzZSIsImxvYWRTY2hlbWEiLCJjbGVhckNhY2hlIiwidGhlbiIsInNjaGVtYUNvbnRyb2xsZXIiLCJjYXRjaCIsImVycm9yIiwidW5kZWZpbmVkIiwiUHJvbWlzZSIsInJlamVjdCIsIlBhcnNlIiwiRXJyb3IiLCJJTlZBTElEX0NMQVNTX05BTUUiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJpbXBvcnRSZXN0T2JqZWN0IiwicmVzdE9iamVjdCIsInRhcmdldENsYXNzIiwicmVzdCIsInVwZGF0ZSIsImF1dGgiLCJvYmplY3RJZCIsIm93bmluZ0lkIiwicmVsYXRpb25OYW1lIiwiX19vcCIsIm9iamVjdHMiLCJfX3R5cGUiLCJyZWxhdGVkSWQiLCJpbmZvIiwiY2xpZW50U0RLIiwiY29kZSIsIk9CSkVDVF9OT1RfRk9VTkQiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJjcmVhdGUiLCJhbGxvd09iamVjdElkIiwiZ2V0UmVzdE9iamVjdHMiLCJyZXNvbHZlIiwicmVzdE9iamVjdHMiLCJpbXBvcnRGaWxlIiwiSlNPTiIsInBhcnNlIiwiZmlsZSIsImJ1ZmZlciIsInRvU3RyaW5nIiwiQXJyYXkiLCJpc0FycmF5IiwicmVzdWx0cyIsInJvd3MiLCJib2R5IiwiZmVlZGJhY2tFbWFpbCIsImVtYWlsQWRhcHRlciIsImhhbmRsZUltcG9ydCIsImVtYWlsQ29udHJvbGxlckFkYXB0ZXIiLCJsb2FkQWRhcHRlciIsInByb21pc2UiLCJyZXNwb25zZSIsInByb3RvdHlwZSIsImZpZWxkcyIsInR5cGUiLCJhbGwiLCJyZWR1Y2UiLCJpdGVtIiwib2JqZWN0IiwiaW5kZXgiLCJwYWdlQXJyYXkiLCJwdXNoIiwiYmluZCIsImxlbmd0aCIsInNsaWNlIiwibWFpblByb21pc2UiLCJjb25jYXQiLCJtYXAiLCJmdW5jIiwic2VuZE1haWwiLCJ0ZXh0IiwidG8iLCJzdWJqZWN0Iiwid3JhcFByb21pc2VSZXF1ZXN0IiwicmVzIiwiaGFuZGxlciIsImRhdGEiLCJqc29uIiwiZXJyIiwic3RhdHVzIiwic2VuZCIsIm1lc3NhZ2UiLCJleHByZXNzUm91dGVyIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInVwbG9hZCIsIm11bHRlciIsInBvc3QiLCJzaW5nbGUiLCJoYW5kbGVQYXJzZUhlYWRlcnMiLCJlbmZvcmNlTWFzdGVyS2V5QWNjZXNzIiwiZXhwb3J0cyIsIl9kZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL1JvdXRlcnMvSW1wb3J0Um91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgbG9hZEFkYXB0ZXIgfSBmcm9tICcuLi9BZGFwdGVycy9BZGFwdGVyTG9hZGVyJztcbmltcG9ydCAqIGFzIG1pZGRsZXdhcmVzIGZyb20gJy4uL21pZGRsZXdhcmVzJztcbmltcG9ydCBtdWx0ZXIgZnJvbSAnbXVsdGVyJztcbmltcG9ydCByZXN0IGZyb20gJy4uL3Jlc3QnO1xuaW1wb3J0IHsgUGFyc2UgfSBmcm9tICdwYXJzZS9ub2RlJztcblxuZXhwb3J0IGNsYXNzIEltcG9ydFJvdXRlciB7XG4gIGdldE9uZVNjaGVtYShyZXEpIHtcbiAgICBjb25zdCBjbGFzc05hbWUgPSByZXEucGFyYW1zLmNsYXNzTmFtZTtcblxuICAgIHJldHVybiByZXEuY29uZmlnLmRhdGFiYXNlXG4gICAgICAubG9hZFNjaGVtYSh7IGNsZWFyQ2FjaGU6IHRydWUgfSlcbiAgICAgIC50aGVuKHNjaGVtYUNvbnRyb2xsZXIgPT4gc2NoZW1hQ29udHJvbGxlci5nZXRPbmVTY2hlbWEoY2xhc3NOYW1lKSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGlmIChlcnJvciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgICAgICAgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICAgICAgICBQYXJzZS5FcnJvci5JTlZBTElEX0NMQVNTX05BTUUsXG4gICAgICAgICAgICAgIGBDbGFzcyAke2NsYXNzTmFtZX0gZG9lcyBub3QgZXhpc3QuYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgICAgICAgbmV3IFBhcnNlLkVycm9yKFxuICAgICAgICAgICAgICBQYXJzZS5FcnJvci5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICAgICAgICAgICdEYXRhYmFzZSBhZGFwdGVyIGVycm9yLidcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIGltcG9ydFJlc3RPYmplY3QocmVxLCByZXN0T2JqZWN0LCB0YXJnZXRDbGFzcykge1xuICAgIGlmICh0YXJnZXRDbGFzcykge1xuICAgICAgcmV0dXJuIHJlc3RcbiAgICAgICAgLnVwZGF0ZShcbiAgICAgICAgICByZXEuY29uZmlnLFxuICAgICAgICAgIHJlcS5hdXRoLFxuICAgICAgICAgIHJlcS5wYXJhbXMuY2xhc3NOYW1lLFxuICAgICAgICAgIHsgb2JqZWN0SWQ6IHJlc3RPYmplY3Qub3duaW5nSWQgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBbcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVdOiB7XG4gICAgICAgICAgICAgIF9fb3A6ICdBZGRSZWxhdGlvbicsXG4gICAgICAgICAgICAgIG9iamVjdHM6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBfX3R5cGU6ICdQb2ludGVyJyxcbiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogdGFyZ2V0Q2xhc3MsXG4gICAgICAgICAgICAgICAgICBvYmplY3RJZDogcmVzdE9iamVjdC5yZWxhdGVkSWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXEuaW5mby5jbGllbnRTREtcbiAgICAgICAgKVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgICAgICAgICBuZXcgUGFyc2UuRXJyb3IoUGFyc2UuRXJyb3IuT0JKRUNUX05PVF9GT1VORCwgJ09iamVjdCBub3QgZm91bmQnKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChyZXN0T2JqZWN0LmNyZWF0ZWRBdCkge1xuICAgICAgZGVsZXRlIHJlc3RPYmplY3QuY3JlYXRlZEF0O1xuICAgIH1cblxuICAgIGlmIChyZXN0T2JqZWN0LnVwZGF0ZWRBdCkge1xuICAgICAgZGVsZXRlIHJlc3RPYmplY3QudXBkYXRlZEF0O1xuICAgIH1cblxuICAgIGlmIChyZXN0T2JqZWN0Lm9iamVjdElkKSB7XG4gICAgICByZXR1cm4gcmVzdFxuICAgICAgICAudXBkYXRlKFxuICAgICAgICAgIHJlcS5jb25maWcsXG4gICAgICAgICAgcmVxLmF1dGgsXG4gICAgICAgICAgcmVxLnBhcmFtcy5jbGFzc05hbWUsXG4gICAgICAgICAgeyBvYmplY3RJZDogcmVzdE9iamVjdC5vYmplY3RJZCB9LFxuICAgICAgICAgIHJlc3RPYmplY3QsXG4gICAgICAgICAgcmVxLmluZm8uY2xpZW50U0RLXG4gICAgICAgIClcbiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IFBhcnNlLkVycm9yLk9CSkVDVF9OT1RfRk9VTkQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXN0LmNyZWF0ZShcbiAgICAgICAgICAgICAgcmVxLmNvbmZpZyxcbiAgICAgICAgICAgICAgcmVxLmF1dGgsXG4gICAgICAgICAgICAgIHJlcS5wYXJhbXMuY2xhc3NOYW1lLFxuICAgICAgICAgICAgICByZXN0T2JqZWN0LFxuICAgICAgICAgICAgICByZXEuaW5mby5jbGllbnRTREssXG4gICAgICAgICAgICAgIHsgYWxsb3dPYmplY3RJZDogdHJ1ZSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3QuY3JlYXRlKHJlcS5jb25maWcsIHJlcS5hdXRoLCByZXEucGFyYW1zLmNsYXNzTmFtZSwgcmVzdE9iamVjdCk7XG4gIH1cblxuICBnZXRSZXN0T2JqZWN0cyhyZXEpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBsZXQgcmVzdE9iamVjdHMgPSBbXTtcbiAgICAgIGxldCBpbXBvcnRGaWxlO1xuXG4gICAgICB0cnkge1xuICAgICAgICBpbXBvcnRGaWxlID0gSlNPTi5wYXJzZShyZXEuZmlsZS5idWZmZXIudG9TdHJpbmcoKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIHBhcnNlIEpTT04gYmFzZWQgb24gdGhlIGZpbGUgc2VudCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShpbXBvcnRGaWxlKSkge1xuICAgICAgICByZXN0T2JqZWN0cyA9IGltcG9ydEZpbGU7XG4gICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoaW1wb3J0RmlsZS5yZXN1bHRzKSkge1xuICAgICAgICByZXN0T2JqZWN0cyA9IGltcG9ydEZpbGUucmVzdWx0cztcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShpbXBvcnRGaWxlLnJvd3MpKSB7XG4gICAgICAgIHJlc3RPYmplY3RzID0gaW1wb3J0RmlsZS5yb3dzO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXJlc3RPYmplY3RzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZGF0YSB0byBpbXBvcnQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlcS5ib2R5LmZlZWRiYWNrRW1haWwpIHtcbiAgICAgICAgaWYgKCFyZXEuY29uZmlnLmVtYWlsQWRhcHRlcikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGhhdmUgdG8gc2V0dXAgYSBNYWlsIEFkYXB0ZXIuJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmVzb2x2ZShyZXN0T2JqZWN0cyk7XG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVJbXBvcnQocmVxKSB7XG4gICAgY29uc3QgZW1haWxDb250cm9sbGVyQWRhcHRlciA9IGxvYWRBZGFwdGVyKHJlcS5jb25maWcuZW1haWxBZGFwdGVyKTtcblxuICAgIGxldCBwcm9taXNlID0gbnVsbDtcblxuICAgIGlmIChyZXEucGFyYW1zLnJlbGF0aW9uTmFtZSkge1xuICAgICAgcHJvbWlzZSA9IHRoaXMuZ2V0T25lU2NoZW1hKHJlcSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKFxuICAgICAgICAgICAgcmVzcG9uc2UuZmllbGRzLFxuICAgICAgICAgICAgcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVcbiAgICAgICAgICApXG4gICAgICAgICkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBSZWxhdGlvbiAke3JlcS5wYXJhbXMucmVsYXRpb25OYW1lfSBkb2VzIG5vdCBleGlzdCBpbiAke3JlcS5wYXJhbXMuY2xhc3NOYW1lfS5gXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICByZXNwb25zZS5maWVsZHNbcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVdLnR5cGUgIT09ICdSZWxhdGlvbidcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgYENsYXNzICR7cmVzcG9uc2UuZmllbGRzW3JlcS5wYXJhbXMucmVsYXRpb25OYW1lXS50YXJnZXRDbGFzc30gZG9lcyBub3QgaGF2ZSBSZWxhdGlvbiB0eXBlLmBcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0Q2xhc3MgPVxuICAgICAgICAgIHJlc3BvbnNlLmZpZWxkc1tyZXEucGFyYW1zLnJlbGF0aW9uTmFtZV0udGFyZ2V0Q2xhc3M7XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFJlc3RPYmplY3RzKHJlcSksIHRhcmdldENsYXNzXSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvbWlzZSA9IFByb21pc2UuYWxsKFt0aGlzLmdldFJlc3RPYmplY3RzKHJlcSldKTtcbiAgICB9XG5cbiAgICBwcm9taXNlID0gcHJvbWlzZVxuICAgICAgLnRoZW4oKFtyZXN0T2JqZWN0cywgdGFyZ2V0Q2xhc3NdKSA9PiB7XG4gICAgICAgIHJldHVybiByZXN0T2JqZWN0cy5yZWR1Y2UoXG4gICAgICAgICAgKGl0ZW0sIG9iamVjdCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGl0ZW0ucGFnZUFycmF5LnB1c2goXG4gICAgICAgICAgICAgIHRoaXMuaW1wb3J0UmVzdE9iamVjdC5iaW5kKHRoaXMsIHJlcSwgb2JqZWN0LCB0YXJnZXRDbGFzcylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgKGluZGV4ICYmIGluZGV4ICUgMTAwID09PSAwKSB8fFxuICAgICAgICAgICAgICBpbmRleCA9PT0gcmVzdE9iamVjdHMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBhZ2VBcnJheSA9IGl0ZW0ucGFnZUFycmF5LnNsaWNlKDApO1xuICAgICAgICAgICAgICBpdGVtLnBhZ2VBcnJheSA9IFtdO1xuXG4gICAgICAgICAgICAgIGl0ZW0ubWFpblByb21pc2UgPSBpdGVtLm1haW5Qcm9taXNlLnRoZW4ocmVzdWx0cyA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgICAgICAgICAgICAgcmVzdWx0cy5jb25jYXQocGFnZUFycmF5Lm1hcChmdW5jID0+IGZ1bmMoKSkpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgeyBwYWdlQXJyYXk6IFtdLCBtYWluUHJvbWlzZTogUHJvbWlzZS5yZXNvbHZlKFtdKSB9XG4gICAgICAgICkubWFpblByb21pc2U7XG4gICAgICB9KVxuICAgICAgLnRoZW4ocmVzdWx0cyA9PiB7XG4gICAgICAgIGlmIChyZXEuYm9keS5mZWVkYmFja0VtYWlsKSB7XG4gICAgICAgICAgZW1haWxDb250cm9sbGVyQWRhcHRlci5zZW5kTWFpbCh7XG4gICAgICAgICAgICB0ZXh0OiBgV2UgaGF2ZSBzdWNjZXNzZnVsbHkgaW1wb3J0ZWQgeW91ciBkYXRhIHRvIHRoZSBjbGFzcyAke1xuICAgICAgICAgICAgICByZXEucGFyYW1zLmNsYXNzTmFtZVxuICAgICAgICAgICAgfSR7XG4gICAgICAgICAgICAgIHJlcS5wYXJhbXMucmVsYXRpb25OYW1lXG4gICAgICAgICAgICAgICAgPyAnLCByZWxhdGlvbiAnICsgcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVcbiAgICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgICB9LmAsXG4gICAgICAgICAgICB0bzogcmVxLmJvZHkuZmVlZGJhY2tFbWFpbCxcbiAgICAgICAgICAgIHN1YmplY3Q6ICdJbXBvcnQgY29tcGxldGVkJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHsgcmVzcG9uc2U6IHJlc3VsdHMgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICBpZiAocmVxLmJvZHkuZmVlZGJhY2tFbWFpbCkge1xuICAgICAgICAgIGVtYWlsQ29udHJvbGxlckFkYXB0ZXIuc2VuZE1haWwoe1xuICAgICAgICAgICAgdGV4dDogYFdlIGNvdWxkIG5vdCBpbXBvcnQgeW91ciBkYXRhIHRvIHRoZSBjbGFzcyAke1xuICAgICAgICAgICAgICByZXEucGFyYW1zLmNsYXNzTmFtZVxuICAgICAgICAgICAgfSR7XG4gICAgICAgICAgICAgIHJlcS5wYXJhbXMucmVsYXRpb25OYW1lXG4gICAgICAgICAgICAgICAgPyAnLCByZWxhdGlvbiAnICsgcmVxLnBhcmFtcy5yZWxhdGlvbk5hbWVcbiAgICAgICAgICAgICAgICA6ICcnXG4gICAgICAgICAgICB9LiBFcnJvcjogJHtlcnJvcn1gLFxuICAgICAgICAgICAgdG86IHJlcS5ib2R5LmZlZWRiYWNrRW1haWwsXG4gICAgICAgICAgICBzdWJqZWN0OiAnSW1wb3J0IGZhaWxlZCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3I6ICcgKyBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgaWYgKHJlcS5ib2R5LmZlZWRiYWNrRW1haWwgJiYgZW1haWxDb250cm9sbGVyQWRhcHRlcikge1xuICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgIHJlc3BvbnNlOlxuICAgICAgICAgICdXZSBhcmUgaW1wb3J0aW5nIHlvdXIgZGF0YS4gWW91IHdpbGwgYmUgbm90aWZpZWQgYnkgZS1tYWlsIG9uY2UgaXQgaXMgY29tcGxldGVkLicsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfVxuXG4gIHdyYXBQcm9taXNlUmVxdWVzdChyZXEsIHJlcywgaGFuZGxlcikge1xuICAgIHJldHVybiBoYW5kbGVyKHJlcSlcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICByZXMuanNvbihkYXRhKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgcmVzLnN0YXR1cyg0MDApLnNlbmQoeyBtZXNzYWdlOiBlcnIubWVzc2FnZSB9KTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZXhwcmVzc1JvdXRlcigpIHtcbiAgICBjb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuICAgIGNvbnN0IHVwbG9hZCA9IG11bHRlcigpO1xuXG4gICAgcm91dGVyLnBvc3QoXG4gICAgICAnL2ltcG9ydF9kYXRhLzpjbGFzc05hbWUnLFxuICAgICAgdXBsb2FkLnNpbmdsZSgnaW1wb3J0RmlsZScpLFxuICAgICAgLy8gbWlkZGxld2FyZXMuYWxsb3dDcm9zc0RvbWFpbixcbiAgICAgIG1pZGRsZXdhcmVzLmhhbmRsZVBhcnNlSGVhZGVycyxcbiAgICAgIG1pZGRsZXdhcmVzLmVuZm9yY2VNYXN0ZXJLZXlBY2Nlc3MsXG4gICAgICAocmVxLCByZXMpID0+XG4gICAgICAgIHRoaXMud3JhcFByb21pc2VSZXF1ZXN0KHJlcSwgcmVzLCB0aGlzLmhhbmRsZUltcG9ydC5iaW5kKHRoaXMpKVxuICAgICk7XG5cbiAgICByb3V0ZXIucG9zdChcbiAgICAgICcvaW1wb3J0X3JlbGF0aW9uX2RhdGEvOmNsYXNzTmFtZS86cmVsYXRpb25OYW1lJyxcbiAgICAgIHVwbG9hZC5zaW5nbGUoJ2ltcG9ydEZpbGUnKSxcbiAgICAgIC8vIG1pZGRsZXdhcmVzLmFsbG93Q3Jvc3NEb21haW4sXG4gICAgICBtaWRkbGV3YXJlcy5oYW5kbGVQYXJzZUhlYWRlcnMsXG4gICAgICBtaWRkbGV3YXJlcy5lbmZvcmNlTWFzdGVyS2V5QWNjZXNzLFxuICAgICAgKHJlcSwgcmVzKSA9PlxuICAgICAgICB0aGlzLndyYXBQcm9taXNlUmVxdWVzdChyZXEsIHJlcywgdGhpcy5oYW5kbGVJbXBvcnQuYmluZCh0aGlzKSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHJvdXRlcjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBJbXBvcnRSb3V0ZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLFFBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLGNBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLFdBQUEsR0FBQUMsdUJBQUEsQ0FBQUgsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLEtBQUEsR0FBQU4sc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFNLEtBQUEsR0FBQU4sT0FBQTtBQUFtQyxTQUFBTyx5QkFBQUMsQ0FBQSw2QkFBQUMsT0FBQSxtQkFBQUMsQ0FBQSxPQUFBRCxPQUFBLElBQUFFLENBQUEsT0FBQUYsT0FBQSxZQUFB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